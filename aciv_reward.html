<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ACIV â€” Civilisations Antiques | RÃ©compense PVS</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Orbitron:wght@500;700&family=Rajdhani:wght@400;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --dark:       #070b17;
  --panel:      #0c1222;
  --border:     rgba(255,255,255,0.09);
  --cyan:       #00d4ff;
  --gold:       #ffd700;
  --gold2:      #f59e0b;
  --red:        #ff4466;
  --parchment:  #c8a55a;
  --stone:      #7a8fa6;
  --purple:     #a78bfa;
  --green:      #4ade80;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Rajdhani', sans-serif;
  background: var(--dark); color: #e0e6f0;
  min-height: 100vh; overflow-x: hidden;
}
body::before {
  content: ''; position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background:
    radial-gradient(ellipse at 5% 10%,  rgba(0,212,255,0.05) 0%, transparent 35%),
    radial-gradient(ellipse at 95% 90%, rgba(255,215,0,0.04)  0%, transparent 35%),
    repeating-linear-gradient(0deg,  transparent, transparent 60px, rgba(255,255,255,0.006) 60px, rgba(255,255,255,0.006) 61px),
    repeating-linear-gradient(90deg, transparent, transparent 60px, rgba(255,255,255,0.006) 60px, rgba(255,255,255,0.006) 61px);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GATE XP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#xpGate {
  position: fixed; inset: 0; z-index: 9000;
  display: flex; align-items: center; justify-content: center;
  background: radial-gradient(circle at 50% 40%, #0d1e3a, #02050e);
}
#xpGate.hidden { display: none; }
.gate-card {
  max-width: 500px; width: 92%;
  border: 1px solid var(--gold);
  background: rgba(8,13,28,0.97);
  padding: 38px 32px; text-align: center;
  position: relative; overflow: hidden;
}
.gate-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: linear-gradient(90deg, var(--cyan), var(--gold), var(--cyan));
}
.gate-icon { font-size: 3rem; margin-bottom: 14px; opacity: 0.8; }
.gate-title {
  font-family: 'Cinzel', serif; font-size: 1.5rem; color: var(--gold);
  text-shadow: 0 0 20px rgba(255,215,0,0.3); margin-bottom: 8px;
}
.gate-sub { color: var(--stone); font-size: 0.85rem; margin-bottom: 22px; line-height: 1.7; }
.xp-box {
  background: rgba(0,0,0,0.4); border: 1px solid var(--border);
  padding: 14px 18px; margin-bottom: 16px;
}
.xp-nums { font-family: 'Orbitron', monospace; font-size: 0.82rem; color: var(--cyan); margin-bottom: 8px; }
.xp-track { height: 6px; background: rgba(255,255,255,0.08); overflow: hidden; }
.xp-fill {
  height: 100%; background: linear-gradient(90deg, var(--cyan), var(--gold));
  transition: width 1.2s cubic-bezier(.4,0,.2,1);
}
.gate-note { font-size: 0.72rem; color: #445; line-height: 1.6; }
.btn-gate {
  display: inline-block; margin-top: 16px; padding: 9px 22px;
  background: linear-gradient(135deg, var(--cyan), var(--gold));
  color: #000; font-weight: 700; border: none; cursor: pointer;
  font-family: 'Orbitron', monospace; font-size: 0.72rem;
  text-transform: uppercase; letter-spacing: 1px; transition: filter .2s;
}
.btn-gate:hover { filter: brightness(1.15); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#mainWrap { display: none; flex-direction: column; min-height: 100vh; position: relative; z-index: 1; }
#mainWrap.on { display: flex; }

/* HEADER */
#siteHdr {
  background: rgba(5,8,18,0.97); border-bottom: 1px solid var(--border);
  padding: 8px 14px;
  display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap;
  position: sticky; top: 0; z-index: 200; backdrop-filter: blur(6px);
}
.hdr-left { display: flex; align-items: center; gap: 12px; }
.hdr-pvs {
  font-family: 'Orbitron', monospace; font-size: 0.58rem;
  background: linear-gradient(135deg, var(--cyan), var(--gold));
  color: #000; padding: 3px 8px; font-weight: 700;
}
.hdr-title {
  font-family: 'Cinzel', serif; font-size: 1rem; color: var(--gold);
  text-shadow: 0 0 12px rgba(255,215,0,0.25);
}
.hdr-right { display: flex; align-items: center; gap: 10px; }
.chip {
  padding: 3px 9px; font-family: 'Share Tech Mono', monospace; font-size: 0.7rem;
  background: rgba(0,0,0,0.4); border: 1px solid;
}
.chip-c { border-color: rgba(0,212,255,0.3); color: var(--cyan); }
.chip-g { border-color: rgba(255,215,0,0.3); color: var(--gold); }
.chip-v { border-color: rgba(167,139,250,0.3); color: var(--purple); }
.btn-s {
  background: rgba(255,255,255,0.05); border: 1px solid var(--border);
  color: #888; padding: 4px 9px; cursor: pointer; font-size: 0.7rem;
  font-family: 'Rajdhani', sans-serif; font-weight: 600; transition: .2s;
}
.btn-s:hover { background: rgba(255,255,255,0.1); color: #ddd; }

/* ARÃˆNE 3 colonnes */
#arena {
  flex: 1; display: grid;
  grid-template-columns: 290px 1fr 320px;
  align-items: start;
}
@media (max-width:1100px) { #arena { grid-template-columns: 240px 1fr 280px; } }
@media (max-width:860px)  {
  #arena { grid-template-columns: 1fr; }
  #gameCenter { order: 1; }
  #panelLeft  { order: 2; }
  #panelRight { order: 3; }
}

/* PANNEAUX */
.side-panel {
  background: rgba(8,12,24,0.9); border-right: 1px solid var(--border);
  overflow-y: auto; max-height: calc(100vh - 50px);
  position: sticky; top: 50px;
}
#panelRight { border-right: none; border-left: 1px solid var(--border); }

.ph {
  background: linear-gradient(135deg, rgba(0,212,255,0.04), rgba(255,215,0,0.03));
  border-bottom: 1px solid var(--border);
  padding: 11px 13px;
  position: sticky; top: 0; z-index: 10; backdrop-filter: blur(4px);
}
.ph-title { font-family: 'Cinzel', serif; font-size: 0.72rem; color: var(--parchment); text-transform: uppercase; letter-spacing: 1.5px; }
.ph-sub   { font-size: 0.65rem; color: var(--stone); margin-top: 2px; }

/* TABS PANNEAU DROIT */
.tab-bar {
  display: flex; border-bottom: 1px solid var(--border);
  position: sticky; top: 0; z-index: 10;
  background: var(--panel);
}
.tab-btn {
  flex: 1; padding: 9px 4px; background: none; border: none; border-bottom: 2px solid transparent;
  color: var(--stone); font-size: 0.65rem; font-family: 'Rajdhani', sans-serif; font-weight: 700;
  cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; transition: .2s;
  text-align: center;
}
.tab-btn.on { color: var(--gold); border-bottom-color: var(--gold); }
.tab-btn:hover:not(.on) { color: #ccc; }
.tab-pane { display: none; }
.tab-pane.on { display: block; }

/* ACCORDION */
.acc-item { border-bottom: 1px solid rgba(255,255,255,0.05); }
.acc-btn {
  width: 100%; background: none; border: none;
  padding: 10px 13px; display: flex; align-items: center; gap: 8px;
  cursor: pointer; text-align: left; transition: background .2s; color: #ccd;
}
.acc-btn:hover { background: rgba(255,255,255,0.03); }
.acc-btn.on { background: rgba(200,165,90,0.05); }
.acc-ico { font-size: 1rem; flex-shrink: 0; }
.acc-lbl { font-family: 'Cinzel', serif; font-size: 0.74rem; flex: 1; line-height: 1.3; }
.acc-tag {
  font-size: 0.58rem; padding: 1px 5px; font-family: 'Rajdhani', sans-serif; font-weight: 700;
  background: rgba(200,165,90,0.12); color: var(--parchment);
  border: 1px solid rgba(200,165,90,0.2); white-space: nowrap;
}
.acc-arr { color: var(--parchment); font-size: 0.65rem; margin-left: 4px; transition: transform .22s; }
.acc-btn.on .acc-arr { transform: rotate(180deg); }
.acc-body { display: none; padding: 11px 13px 14px; background: rgba(0,0,0,0.18); border-top: 1px solid rgba(200,165,90,0.08); }
.acc-body.on { display: block; }
.acc-body p { font-size: 0.76rem; line-height: 1.65; color: #aabbd0; margin-bottom: 7px; }
.acc-body p:last-child { margin-bottom: 0; }

/* blocs internes */
.fact-box {
  background: rgba(200,165,90,0.06); border-left: 2px solid var(--parchment);
  padding: 7px 10px; margin: 7px 0;
}
.fact-lbl { font-size: 0.6rem; color: var(--parchment); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-bottom: 3px; }
.fact-box p { font-size: 0.74rem; color: #ccc; }
.dates-row { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 7px; }
.dtag { background: rgba(0,212,255,0.07); border: 1px solid rgba(0,212,255,0.18); padding: 1px 6px; border-radius: 2px; font-family: 'Share Tech Mono', monospace; font-size: 0.64rem; color: var(--cyan); }
.igame { background: rgba(0,212,255,0.04); border: 1px solid rgba(0,212,255,0.18); padding: 6px 9px; border-radius: 2px; margin-top: 7px; font-size: 0.7rem; color: #8ce0ff; line-height: 1.5; }
.igame .igl { font-size: 0.6rem; color: var(--cyan); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-bottom: 2px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GUIDE DE JEU â€” Ã©lÃ©ments spÃ©cifiques
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.guide-intro {
  padding: 11px 13px 8px;
  border-bottom: 1px solid var(--border);
  font-size: 0.74rem; color: #8aaccc; line-height: 1.65;
}
.guide-intro strong { color: var(--gold); }

/* Sections du guide */
.guide-section { border-bottom: 1px solid rgba(255,255,255,0.05); }
.gs-header {
  padding: 10px 13px;
  display: flex; align-items: center; gap: 8px; cursor: pointer;
  background: none; border: none; width: 100%; text-align: left;
  transition: background .2s; color: #cce;
}
.gs-header:hover { background: rgba(255,255,255,0.03); }
.gs-header.on { background: rgba(0,212,255,0.04); }
.gs-num {
  width: 22px; height: 22px; background: rgba(0,212,255,0.12);
  border: 1px solid rgba(0,212,255,0.3); border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Orbitron', monospace; font-size: 0.58rem; color: var(--cyan); flex-shrink: 0;
}
.gs-label { font-family: 'Cinzel', serif; font-size: 0.73rem; flex: 1; }
.gs-arr { color: var(--cyan); font-size: 0.62rem; transition: transform .22s; }
.gs-header.on .gs-arr { transform: rotate(180deg); }

.gs-body { display: none; padding: 10px 13px 14px; background: rgba(0,0,0,0.15); }
.gs-body.on { display: block; }
.gs-body p  { font-size: 0.74rem; line-height: 1.65; color: #aabbd0; margin-bottom: 7px; }
.gs-body ul { padding-left: 16px; }
.gs-body li { font-size: 0.73rem; line-height: 1.6; color: #aabbd0; margin-bottom: 4px; }
.gs-body li strong { color: #e8e8ff; }

/* cartes spÃ©ciales */
.rule-box {
  background: rgba(0,212,255,0.04); border: 1px solid rgba(0,212,255,0.15);
  padding: 8px 10px; margin: 8px 0; font-size: 0.73rem; color: #9cc8ee; line-height: 1.6;
}
.rule-box .rl { font-size: 0.6rem; color: var(--cyan); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-bottom: 3px; }
.tip-box {
  background: rgba(255,215,0,0.05); border: 1px solid rgba(255,215,0,0.2);
  padding: 8px 10px; margin: 8px 0; font-size: 0.73rem; color: #e8d088; line-height: 1.6;
}
.tip-box .tl { font-size: 0.6rem; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-bottom: 3px; }
.warn-box {
  background: rgba(255,68,102,0.05); border: 1px solid rgba(255,68,102,0.2);
  padding: 8px 10px; margin: 8px 0; font-size: 0.73rem; color: #f8a8b8; line-height: 1.6;
}
.warn-box .wl { font-size: 0.6rem; color: var(--red); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-bottom: 3px; }

/* Tableau civ */
.civ-table { width: 100%; border-collapse: collapse; font-size: 0.68rem; margin: 8px 0; }
.civ-table th { background: rgba(0,0,0,0.4); color: var(--parchment); padding: 5px 7px; text-align: left; border: 1px solid rgba(255,255,255,0.08); font-weight: 700; }
.civ-table td { padding: 5px 7px; border: 1px solid rgba(255,255,255,0.06); color: #aabbd0; }
.civ-table tr:nth-child(even) td { background: rgba(255,255,255,0.02); }
.civ-table .str { color: var(--green); font-weight: 700; }
.civ-table .wk  { color: var(--red); }

/* Phases tour */
.phase-list { padding: 4px 0; }
.phase-item {
  display: flex; gap: 9px; padding: 7px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}
.phase-n {
  width: 20px; height: 20px; background: rgba(255,215,0,0.1);
  border: 1px solid rgba(255,215,0,0.25); border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Orbitron', monospace; font-size: 0.55rem; color: var(--gold); flex-shrink: 0; margin-top: 1px;
}
.phase-c .ph-name { font-size: 0.72rem; font-weight: 700; color: #dde; margin-bottom: 2px; }
.phase-c .ph-desc { font-size: 0.68rem; color: var(--stone); line-height: 1.5; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIMELINE (panneau droit, onglet Histoire)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.timeline { padding: 2px 0; }
.tl-item { display: flex; gap: 9px; padding: 10px 13px; border-bottom: 1px solid rgba(255,255,255,0.04); transition: background .2s; }
.tl-item:hover { background: rgba(255,255,255,0.02); }
.tl-left { display: flex; flex-direction: column; align-items: center; }
.tl-dot { width: 9px; height: 9px; border-radius: 50%; border: 2px solid; flex-shrink: 0; margin-top: 3px; }
.tl-line { width: 1px; flex: 1; min-height: 16px; background: linear-gradient(to bottom, var(--border), transparent); margin: 2px 0; }
.tl-c { flex: 1; }
.tl-yr { font-family: 'Orbitron', monospace; font-size: 0.64rem; color: var(--gold); margin-bottom: 2px; }
.tl-title { font-size: 0.75rem; font-weight: 700; color: #dde; margin-bottom: 2px; }
.tl-desc { font-size: 0.69rem; color: var(--stone); line-height: 1.55; }
.tl-hl {
  font-size: 0.63rem; margin-top: 5px; display: inline-block;
  padding: 2px 7px; border-radius: 2px;
}
.tl-item.active .tl-dot { box-shadow: 0 0 7px; }
.tl-item.active .tl-hl { background: rgba(255,215,0,0.1); color: var(--gold); border: 1px solid rgba(255,215,0,0.25); }
.tl-item.now .tl-dot    { border-color: var(--cyan); box-shadow: 0 0 7px rgba(0,212,255,.4); }
.tl-item.now .tl-hl     { background: rgba(0,212,255,0.08); color: var(--cyan); border: 1px solid rgba(0,212,255,0.25); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OBJECTIFS (panneau droit, onglet Objectifs)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.obj-wrap { padding: 10px 13px; }
.obj-title { font-family: 'Cinzel', serif; font-size: 0.68rem; color: var(--parchment); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px solid rgba(200,165,90,0.18); }
.obj-item { display: flex; align-items: flex-start; gap: 7px; padding: 7px 0; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 0.72rem; color: #99aabb; line-height: 1.5; }
.obj-ico { font-size: 0.9rem; flex-shrink: 0; margin-top: 1px; }
.obj-xp { font-family: 'Orbitron', monospace; font-size: 0.6rem; color: var(--gold); white-space: nowrap; margin-top: 2px; }
.obj-done { color: var(--green) !important; }
.obj-input { display: flex; gap: 5px; margin-top: 4px; }
.obj-input input {
  width: 90px; padding: 3px 7px; background: #0a0a1a; border: 1px solid #2a2a4a;
  color: #fff; font-size: 0.67rem; font-family: 'Share Tech Mono', monospace; border-radius: 2px; outline: none;
}
.obj-input button {
  padding: 3px 9px; background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.25);
  color: var(--gold); font-size: 0.67rem; cursor: pointer; border-radius: 2px;
  font-family: 'Rajdhani', sans-serif; font-weight: 700;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CENTRE â€” JEU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#gameCenter { display: flex; flex-direction: column; background: #000; }
#gameTopBar {
  background: rgba(3,6,14,0.99); border-bottom: 1px solid var(--border);
  padding: 7px 14px; display: flex; align-items: center; justify-content: space-between; gap: 8px; flex-wrap: wrap;
}
.gtb-title { font-family: 'Orbitron', monospace; font-size: 0.65rem; color: var(--cyan); letter-spacing: 1px; }
.sess-xp { font-family: 'Share Tech Mono', monospace; font-size: 0.68rem; color: var(--gold); }
#dosWrap {
  flex: 1; min-height: 420px; background: #000; position: relative;
  display: flex; align-items: center; justify-content: center;
}
#gameLoading {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 10px; color: #334; text-align: center; padding: 32px; width: 100%;
}
.load-glyph { font-family: 'Share Tech Mono', monospace; font-size: 0.76rem; color: #223; line-height: 1.8; letter-spacing: 1.5px; }
.scan { width: 180px; height: 2px; background: linear-gradient(90deg, transparent, var(--cyan), transparent); animation: sc 2s ease-in-out infinite; }
@keyframes sc { 0%,100%{opacity:.15} 50%{opacity:1} }
#jsdosMount { width:100%; height:100%; min-height:480px; display:none; }
#bottomBar {
  background: rgba(3,6,14,0.97); border-top: 1px solid var(--border);
  padding: 7px 14px; display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
}
.bb-i { display:flex; align-items:center; gap:5px; font-size:.68rem; color:var(--stone); }
.bb-v { font-family:'Orbitron',monospace; font-size:.66rem; color:var(--gold); }
.bb-sep { color:var(--border); }
.tip-t { flex:1; font-size:.67rem; color:#445; font-family:'Share Tech Mono',monospace; }

/* XP notif */
#xpNotif {
  position:fixed; bottom:55px; right:18px; z-index:1000;
  background:rgba(255,215,0,.1); border:1px solid rgba(255,215,0,.35);
  padding:8px 14px; font-family:'Orbitron',monospace; font-size:.72rem; color:var(--gold);
  display:none; backdrop-filter:blur(5px);
  animation: ns .3s ease;
}
@keyframes ns { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

/* scrollbar */
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-track{background:rgba(0,0,0,.25)}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,.08)}
</style>
</head>
<body>

<!-- GATE XP -->
<div id="xpGate">
  <div class="gate-card">
    <div class="gate-icon">ğŸ›ï¸</div>
    <div class="gate-title">Civilisations Antiques</div>
    <p class="gate-sub">
      Cette rÃ©compense est rÃ©servÃ©e aux dÃ©lÃ©guÃ©s qui ont complÃ©tÃ©<br>
      le pilier <strong>"La CitÃ© & le DÃ©mos"</strong> dans l'Agora.<br>
      Le seuil d'XP minimum est Ã©galement vÃ©rifiÃ©.
    </p>
    <div class="xp-box">
      <div class="xp-nums">
        <span id="gCur">0</span> / <span id="gThr" style="color:#445">500</span> XP requis
      </div>
      <div class="xp-track"><div class="xp-fill" id="gBar" style="width:0%"></div></div>
      <div style="font-size:.68rem;color:#445;margin-top:4px">Joueur : <span id="gPlayer" style="color:var(--cyan)">â€”</span></div>
    </div>
    <p class="gate-note">Complete les missions pHARe, DÃ©lÃ©guÃ©s et Hub VidÃ©os.<br>Reviens ici depuis l'Agora quand le pilier est terminÃ©.</p>
    <button class="btn-gate" onclick="goPortal()">â† Retour Ã  l'Agora</button>
  </div>
</div>

<!-- INTERFACE PRINCIPALE -->
<div id="mainWrap">

  <header id="siteHdr">
    <div class="hdr-left">
      <div class="hdr-pvs">PVS Â· RÃ‰COMPENSE</div>
      <div class="hdr-title">Advanced Civilization â€” Avalon Hill, 1995</div>
    </div>
    <div class="hdr-right">
      <div class="chip chip-c">ğŸ® <span id="hPlayer">â€”</span></div>
      <div class="chip chip-g">âš¡ <span id="hXP">0</span> XP</div>
      <div class="chip chip-v">ğŸ•¹ Session <span id="hSess">00:00</span></div>
      <button class="btn-s" onclick="togglePanels()">Panneaux</button>
      <button class="btn-s" onclick="goPortal()">â† Agora</button>
    </div>
  </header>

  <div id="arena">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PANNEAU GAUCHE â€” ENCYCLOPÃ‰DIE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <aside class="side-panel" id="panelLeft">
      <div class="ph">
        <div class="ph-title">ğŸ“œ EncyclopÃ©die</div>
        <div class="ph-sub">Civilisations mÃ©diterranÃ©ennes antiques</div>
      </div>

      <div style="padding:10px 13px 8px; border-bottom:1px solid var(--border); font-size:.72rem; color:#7a9ab8; line-height:1.65;">
        Le jeu couvre la pÃ©riode de l'<span style="color:var(--parchment)">Ã‚ge de Pierre</span> Ã 
        l'<span style="color:var(--parchment)">Ã‚ge du Fer</span> â€” le berceau de nos dÃ©mocraties.
      </div>

      <!-- MÃ‰SOPOTAMIE -->
      <div class="acc-item">
        <button class="acc-btn" onclick="togAcc(this)">
          <span class="acc-ico">ğŸŒŠ</span>
          <span class="acc-lbl">MÃ©sopotamie</span>
          <span class="acc-tag">5e HIS</span>
          <span class="acc-arr">â–¼</span>
        </button>
        <div class="acc-body">
          <div class="dates-row"><span class="dtag">~3500 av. J.-C.</span><span class="dtag">Sumer â†’ Babylone</span></div>
          <p>Entre le Tigre et l'Euphrate (Irak actuel) naissent les premiÃ¨res citÃ©s-Ã‰tats : <strong>Ur, Uruk, Nippur</strong>. Les SumÃ©riens inventent l'Ã©criture cunÃ©iforme vers 3200 av. J.-C.</p>
          <div class="fact-box">
            <div class="fact-lbl">ğŸ’¡ Ã€ retenir</div>
            <p>Le <strong>Code d'Hammurabi</strong> (v.1750 av. J.-C.) : 282 lois gravÃ©es sur basalte. Premier code de droit systÃ©matique connu.</p>
          </div>
          <p>Babylone sous Nabuchodonosor II (605â€“562) : 200 000 habitants, jardins suspendus, astronomie avancÃ©e.</p>
          <div class="igame"><div class="igl">ğŸ® Dans le jeu</div>La civ <strong>Babylon</strong> dÃ©bute en MÃ©sopotamie. Les TOOLS <em>Pottery</em> et <em>Grain</em> reflÃ¨tent les vraies innovations sumÃ©riennes.</div>
        </div>
      </div>

      <!-- Ã‰GYPTE -->
      <div class="acc-item">
        <button class="acc-btn" onclick="togAcc(this)">
          <span class="acc-ico">ğ“‚€</span>
          <span class="acc-lbl">Ã‰gypte Pharaonique</span>
          <span class="acc-tag">6e HIS</span>
          <span class="acc-arr">â–¼</span>
        </button>
        <div class="acc-body">
          <div class="dates-row"><span class="dtag">~3100 av. J.-C.</span><span class="dtag">Narmer â†’ ClÃ©opÃ¢tre</span></div>
          <p>UnifiÃ©e par Narmer vers 3100 av. J.-C., l'Ã‰gypte prospÃ¨re grÃ¢ce aux crues annuelles du Nil qui dÃ©posent un limon fertile. Trois millÃ©naires de continuitÃ© culturelle.</p>
          <div class="fact-box">
            <div class="fact-lbl">ğŸ’¡ Ã€ retenir</div>
            <p>Pyramides de Gizeh (2550â€“2490 av. J.-C.) : KhÃ©ops, KhÃ©phren, MykÃ©rinos. La Grande Pyramide pÃ¨se 6 millions de tonnes. Seule merveille antique encore debout.</p>
          </div>
          <p>L'Ã©criture <em>hiÃ©roglyphique</em> (700+ signes) sera dÃ©chiffrÃ©e par Champollion en 1822 grÃ¢ce Ã  la Pierre de Rosette.</p>
          <div class="igame"><div class="igl">ğŸ® Dans le jeu</div><strong>Egypt</strong> : accÃ¨s direct Ã  la vallÃ©e du Nil, trÃ¨s fertile. Avantage pour construire des citÃ©s dÃ¨s le dÃ©but.</div>
        </div>
      </div>

      <!-- GRÃˆCE -->
      <div class="acc-item">
        <button class="acc-btn" onclick="togAcc(this)">
          <span class="acc-ico">ğŸº</span>
          <span class="acc-lbl">GrÃ¨ce Antique & la DÃ©mocratie</span>
          <span class="acc-tag">5e HIS</span>
          <span class="acc-arr">â–¼</span>
        </button>
        <div class="acc-body">
          <div class="dates-row"><span class="dtag">~800 av. J.-C.</span><span class="dtag">ArchaÃ¯que â†’ hellÃ©nistique</span></div>
          <p>Non pas un Ã‰tat mais un <strong>archipel de citÃ©s-Ã‰tats</strong> (<em>poleis</em>) : AthÃ¨nes, Sparte, Corinthe, ThÃ¨bes. Chacune avec ses institutions, sa monnaie, ses lois.</p>
          <div class="fact-box">
            <div class="fact-lbl">ğŸ—³ La DÃ©mocratie â€” naissance</div>
            <p>ClisthÃ¨ne (508 av. J.-C.) instaure la <strong>dÃ©mocratie directe</strong> Ã  AthÃ¨nes : chaque citoyen vote en personne Ã  l'<em>EkklÃ©sia</em> (AssemblÃ©e du peuple). Le mot vient de <em>demos</em> (peuple) + <em>kratos</em> (pouvoir).</p>
          </div>
          <p>Limites : les esclaves (30â€“40 % de la population), les femmes et les <em>mÃ©tÃ¨ques</em> (Ã©trangers rÃ©sidents) sont exclus. La dÃ©mocratie athÃ©nienne ne concerne que ~10 % des habitants.</p>
          <div class="igame"><div class="igl">ğŸ® Dans le jeu</div><strong>Greece</strong> : civ maritime par excellence. Le TOOL <em>Astronomy</em> lui permet d'envoyer ses navires loin â€” comme les vraies colonies grecques de Marseille Ã  CrimÃ©e.</div>
        </div>
      </div>

      <!-- PHÃ‰NICIE / CARTHAGE -->
      <div class="acc-item">
        <button class="acc-btn" onclick="togAcc(this)">
          <span class="acc-ico">âš“</span>
          <span class="acc-lbl">PhÃ©nicie & Carthage</span>
          <span class="acc-tag">5e HIS</span>
          <span class="acc-arr">â–¼</span>
        </button>
        <div class="acc-body">
          <div class="dates-row"><span class="dtag">~1200 av. J.-C.</span><span class="dtag">Tyr â†’ Carthage</span></div>
          <p>Navigateurs et marchands du monde antique. Leur invention majeure : l'<strong>alphabet consonantique</strong> (22 lettres, ~1050 av. J.-C.) â€” ancÃªtre de tous nos alphabets modernes.</p>
          <div class="fact-box">
            <div class="fact-lbl">ğŸ’¡ Carthage vs Rome</div>
            <p>FondÃ©e vers 814 av. J.-C. prÃ¨s de Tunis, Carthage rivalise avec Rome. Guerres Puniques (264â€“146). Hannibal franchit les Alpes avec 37 Ã©lÃ©phants. Rome finit par raser Carthage en 146 av. J.-C.</p>
          </div>
          <div class="igame"><div class="igl">ğŸ® Dans le jeu</div><strong>Carthage</strong> : Afrique du Nord, routes maritimes immÃ©diates. Le TOOL <em>Trade</em> reflÃ¨te l'ADN phÃ©nicien â€” tout est commerce.</div>
        </div>
      </div>

      <!-- CRÃˆTE / ROME -->
      <div class="acc-item">
        <button class="acc-btn" onclick="togAcc(this)">
          <span class="acc-ico">ğŸ¦…</span>
          <span class="acc-lbl">Rome & la RÃ©publique</span>
          <span class="acc-tag">5e HIS</span>
          <span class="acc-arr">â–¼</span>
        </button>
        <div class="acc-body">
          <div class="dates-row"><span class="dtag">509 av. J.-C.</span><span class="dtag">RÃ©publique â†’ Empire</span></div>
          <p>En 509 av. J.-C., Rome chasse son dernier roi et instaure la <strong>RÃ©publique</strong> : deux consuls Ã©lus chaque annÃ©e, le SÃ©nat comme assemblÃ©e de sages, les Comices pour voter les lois.</p>
          <div class="fact-box">
            <div class="fact-lbl">ğŸ› La ReprÃ©sentation avant la dÃ©mocratie</div>
            <p>Rome invente la <strong>dÃ©mocratie reprÃ©sentative</strong> : au lieu de voter eux-mÃªmes sur tout, les citoyens <em>Ã©lisent des reprÃ©sentants</em> (tribuns, consuls). Ce modÃ¨le inspirera les parlements modernes.</p>
          </div>
          <p>Le <em>SÃ©nat</em> (de <em>senex</em>, vieillard) influence encore notre mot <em>sÃ©nateur</em>. La <em>plÃ¨be</em> obtient ses tribuns en 494 av. J.-C. â€” premiÃ¨re lutte sociale pour la reprÃ©sentation populaire.</p>
          <div class="igame"><div class="igl">ğŸ® Dans le jeu</div><strong>Italie/Rome</strong> : civ centrale sur la carte. Le TOOL <em>Law</em> reflÃ¨te l'obsession romaine du droit et de l'organisation.</div>
        </div>
      </div>

      <!-- PERSE -->
      <div class="acc-item">
        <button class="acc-btn" onclick="togAcc(this)">
          <span class="acc-ico">ğŸ¦</span>
          <span class="acc-lbl">Empire Perse</span>
          <span class="acc-tag">5e HIS</span>
          <span class="acc-arr">â–¼</span>
        </button>
        <div class="acc-body">
          <div class="dates-row"><span class="dtag">550 av. J.-C.</span><span class="dtag">Cyrus â†’ Darius III</span></div>
          <p>Cyrus II fonde le premier Empire achÃ©mÃ©nide en 550. Ã€ son apogÃ©e sous Darius Ier : de l'Indus Ã  l'Ã‰gypte â€” le plus grand empire de l'AntiquitÃ©, ~50 millions d'habitants.</p>
          <div class="fact-box">
            <div class="fact-lbl">ğŸ’¡ La Route Royale</div>
            <p>2700 km de Suse Ã  Sardes, traversable en 7 jours grÃ¢ce Ã  des relais de chevaux. PremiÃ¨re infrastructure de communication de masse â€” prÃ©figure internet.</p>
          </div>
          <p>Guerres mÃ©diques (490â€“479 av. J.-C.) : Marathon, Salamine, PlatÃ©es. La rÃ©sistance grecque sauvegarde la dÃ©mocratie naissante en Europe.</p>
          <div class="igame"><div class="igl">ğŸ® Dans le jeu</div><strong>Persia</strong> : dÃ©marre Ã  l'Est. Fort potentiel de population. Menace permanente sur les civs mÃ©diterranÃ©ennes.</div>
        </div>
      </div>

      <!-- NOTE PROGRAMME -->
      <div style="padding:10px 13px; background:rgba(0,212,255,0.03); border-top:1px solid rgba(0,212,255,0.12);">
        <div style="font-family:'Cinzel',serif; font-size:.65rem; color:var(--cyan); text-transform:uppercase; letter-spacing:1px; margin-bottom:6px;">Programme d'histoire</div>
        <p style="font-size:.7rem; color:#6a8aaa; line-height:1.7;">
          <strong style="color:#99b">6e :</strong> PremiÃ¨res civilisations, Ã©criture, Ã‰gypte, GrÃ¨ce archaÃ¯que<br>
          <strong style="color:#99b">5e :</strong> AthÃ¨nes, Perse, Rome, Carthage, dÃ©mocratie, RÃ©publique<br>
          <strong style="color:#99b">CompÃ©tences :</strong> Localiser dans le temps et l'espace Â· Lire une carte historique Â· Analyser un document.
        </p>
      </div>
    </aside><!-- /panelLeft -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         CENTRE â€” JEU
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main id="gameCenter">
      <div id="gameTopBar">
        <div class="gtb-title">DOS Â· ACIV.EXE Â· 640Ã—480 Â· 256 couleurs</div>
        <div class="sess-xp">Session : <span id="sessXP">0</span> XP</div>
        <button class="btn-s" onclick="loadGame()" id="btnLoad">â–¶ Lancer</button>
        <button class="btn-s" onclick="expandGame()">â›¶ Plein Ã©cran</button>
      </div>

      <div id="dosWrap">
        <div id="gameLoading">
          <div style="font-size:2.2rem;opacity:.25;margin-bottom:8px;">ğŸ›ï¸</div>
          <div class="load-glyph">
            ADVANCED CIVILIZATION<br>
            AVALON HILL Â· DOS Â· 1995<br>
            486+ Â· SVGA Â· 16MB RAM
          </div>
          <div class="scan"></div>
          <p style="font-size:.68rem;color:#2a3a4a;margin-top:14px;max-width:280px;line-height:1.65;">
            Clique sur <strong style="color:var(--cyan)">â–¶ Lancer</strong> pour dÃ©marrer.<br>
            Les fichiers doivent Ãªtre dans <code style="color:#446">game/aciv.jsdos</code>
          </p>
          <div style="margin-top:10px;padding:10px;background:rgba(255,215,0,0.03);border:1px solid rgba(255,215,0,0.12);font-size:.67rem;color:#665;max-width:320px;line-height:1.65;text-align:left;">
            <strong style="color:var(--gold)">âš™ GitHub Pages :</strong> placer le bundle <code>game/aciv.jsdos</code>.<br>
            Voir le README pour crÃ©er le bundle depuis les fichiers DOS.
          </div>
        </div>
        <div id="jsdosMount"></div>
      </div>

      <div id="bottomBar">
        <div class="bb-i">â± <span class="bb-v" id="bTime">00:00</span></div>
        <div class="bb-sep">|</div>
        <div class="bb-i">ğŸ™ CitÃ©s : <span class="bb-v" id="bCit">0</span></div>
        <div class="bb-sep">|</div>
        <div class="bb-i">ğŸ“š TOOLS : <span class="bb-v" id="bTool">0</span></div>
        <div class="bb-sep">|</div>
        <div class="tip-t" id="tipT">ğŸ’¡ Construis tes citÃ©s dans les cases rouges/jaunes pour rÃ©cupÃ©rer des cartes de commerce.</div>
      </div>
    </main>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PANNEAU DROIT â€” 3 ONGLETS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <aside class="side-panel" id="panelRight">

      <!-- ONGLETS -->
      <div class="tab-bar">
        <button class="tab-btn on" onclick="switchTab(this,'tHist')">â³ Histoire</button>
        <button class="tab-btn"   onclick="switchTab(this,'tGuide')">ğŸ® Guide</button>
        <button class="tab-btn"   onclick="switchTab(this,'tObj')">ğŸ† Objectifs</button>
      </div>

      <!-- â”€â”€ ONGLET HISTOIRE â”€â”€ -->
      <div class="tab-pane on" id="tHist">
        <div class="timeline">

          <div class="tl-item">
            <div class="tl-left"><div class="tl-dot" style="border-color:#6a5a40"></div><div class="tl-line"></div></div>
            <div class="tl-c">
              <div class="tl-yr">1954</div>
              <div class="tl-title">Civilization â€” Jeu de plateau</div>
              <div class="tl-desc">Francis Tresham crÃ©e le jeu de plateau <em>Civilization</em> en Angleterre. 6â€“8 joueurs, durÃ©e : une journÃ©e entiÃ¨re.</div>
            </div>
          </div>

          <div class="tl-item">
            <div class="tl-left"><div class="tl-dot" style="border-color:#4a6a4a"></div><div class="tl-line"></div></div>
            <div class="tl-c">
              <div class="tl-yr">1980</div>
              <div class="tl-title">Advanced Civilization â€” Avalon Hill</div>
              <div class="tl-desc">Version avancÃ©e : 8 civilisations, carte MÃ©diterranÃ©e complÃ¨te, commerce, technologies. Jeu lÃ©gendaire dans les wargames.</div>
            </div>
          </div>

          <div class="tl-item">
            <div class="tl-left"><div class="tl-dot" style="border-color:#4a4a8a"></div><div class="tl-line"></div></div>
            <div class="tl-c">
              <div class="tl-yr">1991</div>
              <div class="tl-title">Sid Meier's Civilization â€” PC</div>
              <div class="tl-desc">Sid Meier (MicroProse) s'inspire explicitement du jeu d'Avalon Hill pour crÃ©er l'un des jeux les plus influents de l'histoire vidÃ©oludique.</div>
              <div class="tl-hl">"L'un des jeux qui a le plus influencÃ© ma carriÃ¨re." â€” Sid Meier</div>
            </div>
          </div>

          <div class="tl-item active">
            <div class="tl-left"><div class="tl-dot" style="border-color:var(--gold)"></div><div class="tl-line"></div></div>
            <div class="tl-c">
              <div class="tl-yr">1995</div>
              <div class="tl-title">ACIV â€” Version PC DOS</div>
              <div class="tl-desc">Avalon Hill adapte son jeu de plateau sur PC. SVGA 640Ã—480, jusqu'Ã  8 joueurs IA ou humains, dÃ©veloppÃ© pour 486 sous MS-DOS.</div>
              <div class="tl-hl">ğŸ“€ C'est ce fichier que tu joues maintenant !</div>
            </div>
          </div>

          <div class="tl-item">
            <div class="tl-left"><div class="tl-dot" style="border-color:#5a3a3a"></div><div class="tl-line"></div></div>
            <div class="tl-c">
              <div class="tl-yr">1998</div>
              <div class="tl-title">Hasbro rachÃ¨te Avalon Hill</div>
              <div class="tl-desc">En difficultÃ© financiÃ¨re, Avalon Hill est vendu Ã  Hasbro. La plupart des jeux cessent d'Ãªtre distribuÃ©s. ACIV entre dans l'abandonware.</div>
            </div>
          </div>

          <div class="tl-item">
            <div class="tl-left"><div class="tl-dot" style="border-color:#3a5a6a"></div><div class="tl-line"></div></div>
            <div class="tl-c">
              <div class="tl-yr">2008â€“2021</div>
              <div class="tl-title">DOSBox â†’ WebAssembly</div>
              <div class="tl-desc">DOSBox (open-source) est compilÃ© en WASM par le projet js-dos. Des jeux DOS de 1995 tournent dÃ©sormais dans un navigateur.</div>
              <div class="tl-hl">âš¡ Hardware des annÃ©es 90 Ã©mulÃ© par JavaScript</div>
            </div>
          </div>

          <div class="tl-item now">
            <div class="tl-left"><div class="tl-dot"></div></div>
            <div class="tl-c">
              <div class="tl-yr">2026</div>
              <div class="tl-title">Toi, ici, maintenant</div>
              <div class="tl-desc">Un jeu de 1995, sur un moteur de 1980, dans la lignÃ©e de l'Agora athÃ©nienne de 508 av. J.-C. â€” dans ton navigateur de collÃ¨ge.</div>
              <div class="tl-hl">ğŸ›ï¸ L'histoire du jeu est une histoire de civilisation</div>
            </div>
          </div>

        </div>
      </div><!-- /tHist -->

      <!-- â”€â”€ ONGLET GUIDE DE JEU â”€â”€ -->
      <div class="tab-pane" id="tGuide">

        <div class="guide-intro">
          <strong>Advanced Civilization</strong> est un jeu de <strong>stratÃ©gie pure</strong> :
          aucun dÃ©, aucun hasard. Tu construis une civilisation mÃ©diterranÃ©enne de l'Ã‚ge de Pierre
          Ã  l'Ã‚ge du Fer. Le premier Ã  atteindre le bout de la piste d'Ã¢ges (AST) gagne.
          Ce guide te donne les outils pour comprendre et commencer Ã  gagner.
        </div>

        <!-- S1 : Vue d'ensemble -->
        <div class="guide-section">
          <button class="gs-header on" onclick="togGuide(this)">
            <div class="gs-num">1</div>
            <div class="gs-label">Vue d'ensemble â€” l'objectif</div>
            <div class="gs-arr">â–¼</div>
          </button>
          <div class="gs-body on">
            <p>Le but n'est <strong>pas de conquÃ©rir la carte</strong>. C'est de faire <strong>avancer ton pion sur l'AST</strong> (Advancement of Science Track) â€” une piste chronologique qui va de l'Ã‚ge de Pierre, au Bronze, puis au Fer.</p>
            <div class="rule-box">
              <div class="rl">ğŸ“Œ RÃ¨gle clÃ©</div>
              Pour avancer sur l'AST, il faut avoir un certain nombre de <strong>citÃ©s</strong> ET avoir acquis certaines <strong>technologies (TOOLS)</strong>. Les deux ensemble.
            </div>
            <p>Ton avancement sur l'AST dÃ©pend de ton niveau de culture : plus tu as de citÃ©s, plus tu collectes de cartes de commerce, plus tu peux acheter de technologies. Tout est liÃ©.</p>
            <div class="tip-box">
              <div class="tl">ğŸ’¡ MentalitÃ© gagnante</div>
              Pense "constructeur de civilisation", pas "conquÃ©rant". La guerre dÃ©truit autant chez toi que chez l'adversaire. Le vrai chemin vers la victoire passe par les citÃ©s et les technologies.
            </div>
          </div>
        </div>

        <!-- S2 : Structure d'un tour -->
        <div class="guide-section">
          <button class="gs-header" onclick="togGuide(this)">
            <div class="gs-num">2</div>
            <div class="gs-label">Structure d'un tour (8 phases)</div>
            <div class="gs-arr">â–¼</div>
          </button>
          <div class="gs-body">
            <p>Chaque tour se dÃ©roule en <strong>8 phases dans l'ordre</strong> â€” tout le monde joue chaque phase avant de passer Ã  la suivante :</p>
            <div class="phase-list">
              <div class="phase-item">
                <div class="phase-n">1</div>
                <div class="phase-c">
                  <div class="ph-name">Croissance dÃ©mographique</div>
                  <div class="ph-desc">Chaque territoire occupÃ© ajoute 1 token population. Tes citÃ©s deviennent temporairement des tokens aussi.</div>
                </div>
              </div>
              <div class="phase-item">
                <div class="phase-n">2</div>
                <div class="phase-c">
                  <div class="ph-name">Mouvement</div>
                  <div class="ph-desc">Tes tokens se dÃ©placent dans des territoires adjacents (1 case/tour par terre, plus par mer avec navires).</div>
                </div>
              </div>
              <div class="phase-item">
                <div class="phase-n">3</div>
                <div class="phase-c">
                  <div class="ph-name">Conflits</div>
                  <div class="ph-desc">Si deux civs se retrouvent dans le mÃªme territoire, chaque camp perd autant de tokens que l'autre en a. Pas de dÃ© â€” pure arithmÃ©tique.</div>
                </div>
              </div>
              <div class="phase-item">
                <div class="phase-n">4</div>
                <div class="phase-c">
                  <div class="ph-name">Construction de citÃ©s</div>
                  <div class="ph-desc">Si tu as exactement 6 tokens dans un site de citÃ© (case rouge ou jaune), ils se transforment en une citÃ©.</div>
                </div>
              </div>
              <div class="phase-item">
                <div class="phase-n">5</div>
                <div class="phase-c">
                  <div class="ph-name">Suppression des surplus</div>
                  <div class="ph-desc">Chaque territoire a une capacitÃ© max. Les tokens en excÃ¨s sont <strong>automatiquement supprimÃ©s</strong>. Attention !</div>
                </div>
              </div>
              <div class="phase-item">
                <div class="phase-n">6</div>
                <div class="phase-c">
                  <div class="ph-name">Collecte des cartes de commerce</div>
                  <div class="ph-desc">Chaque citÃ© donne 1 carte. La valeur des cartes augmente avec le nombre de citÃ©s que tu possÃ¨des.</div>
                </div>
              </div>
              <div class="phase-item">
                <div class="phase-n">7</div>
                <div class="phase-c">
                  <div class="ph-name">Commerce (nÃ©goce)</div>
                  <div class="ph-desc">Tu Ã©changes des cartes avec les autres joueurs pour constituer des ensembles (triplets, quadruplets) de la mÃªme marchandise â€” Ã§a vaut bien plus qu'un tas disparate.</div>
                </div>
              </div>
              <div class="phase-item">
                <div class="phase-n">8</div>
                <div class="phase-c">
                  <div class="ph-name">Achat de technologies (TOOLS)</div>
                  <div class="ph-desc">Tu dÃ©penses la valeur totale de tes cartes pour acheter des technologies dans l'arbre de connaissance.</div>
                </div>
              </div>
            </div>
            <div class="warn-box">
              <div class="wl">âš  CalamitÃ©s</div>
              Certaines cartes de commerce dÃ©clenchent des <strong>calamitÃ©s</strong> (Ã©pidÃ©mie, famine, guerre civile...) qui peuvent dÃ©cimer ta population ou dÃ©truire des citÃ©s. Les technologies comme <em>Medicine</em> ou <em>Grain</em> te protÃ¨gent.
            </div>
          </div>
        </div>

        <!-- S3 : Construire des citÃ©s -->
        <div class="guide-section">
          <button class="gs-header" onclick="togGuide(this)">
            <div class="gs-num">3</div>
            <div class="gs-label">Construire des citÃ©s â€” la prioritÃ© nÂ°1</div>
            <div class="gs-arr">â–¼</div>
          </button>
          <div class="gs-body">
            <p>Les citÃ©s sont le <strong>moteur de ta civilisation</strong>. Chaque citÃ© = 1 carte de commerce par tour. Plus de citÃ©s = cartes plus prÃ©cieuses = plus de technologies.</p>
            <div class="rule-box">
              <div class="rl">ğŸ“Œ Comment construire une citÃ©</div>
              AmÃ¨ne exactement <strong>6 tokens</strong> dans un territoire marquÃ© d'un site de citÃ© (case <strong style="color:#f66">rouge</strong> ou <strong style="color:#ffd700">jaune</strong>). Ã€ la phase 4, ils se transforment automatiquement en citÃ©.
            </div>
            <ul>
              <li><strong>Sites rouges</strong> : sites primaires, souvent bien placÃ©s mais disputÃ©s.</li>
              <li><strong>Sites jaunes</strong> : sites secondaires, moins intÃ©ressants mais plus accessibles.</li>
              <li>Une citÃ© ne peut pas Ãªtre dans le mÃªme territoire qu'une autre citÃ©.</li>
              <li>Une citÃ© dÃ©truite par un conflit redevient des tokens adverses.</li>
            </ul>
            <div class="tip-box">
              <div class="tl">ğŸ’¡ StratÃ©gie citÃ©s</div>
              <ul>
                <li>Vise 3 citÃ©s avant le tour 5. Avec 3 citÃ©s, tu obtiens des cartes de valeur 3+.</li>
                <li>ProtÃ¨ge tes citÃ©s â€” laisse toujours 1â€“2 tokens de garnison.</li>
                <li>Si un adversaire menace tes sites, bloque-les avec tes tokens AVANT lui.</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- S4 : Le commerce -->
        <div class="guide-section">
          <button class="gs-header" onclick="togGuide(this)">
            <div class="gs-num">4</div>
            <div class="gs-label">Les cartes de commerce â€” comment Ã§a marche</div>
            <div class="gs-arr">â–¼</div>
          </button>
          <div class="gs-body">
            <p>Les cartes de commerce reprÃ©sentent des marchandises antiques : <em>blÃ©, vin, huile, gemmes, soie, Ã©pices</em>... Elles ont une valeur nominale de 1 Ã  9.</p>
            <div class="rule-box">
              <div class="rl">ğŸ“Œ Valeur d'un ensemble</div>
              Un ensemble de 3 cartes identiques vaut leur valeur nominale Ã— 3. <br>Un ensemble de 4 vaut Ã— 4, etc. <br>Exemple : 3 cartes "Gemmes" (valeur 9) = 27 points de commerce.
            </div>
            <p>La valeur des cartes tirÃ©es dÃ©pend de ton nombre de citÃ©s. Avec 1 citÃ©, tu ne piras jamais de cartes de valeur 6+. Avec 5+ citÃ©s, tu accÃ¨des aux cartes rares et prÃ©cieuses.</p>
            <div class="tip-box">
              <div class="tl">ğŸ’¡ StratÃ©gie de commerce</div>
              <ul>
                <li>NÃ©gocie toujours pour complÃ©ter des ensembles. Un triplet vaut 3Ã— plus que 3 cartes isolÃ©es.</li>
                <li>N'accepte jamais une carte de calamitÃ© en Ã©change â€” refuse poliment ou impose une contrepartie.</li>
                <li>Si tu as 3 cartes Grain, ne les trade pas â€” Grain te protÃ¨ge de la famine (calamitÃ© dÃ©vastatrice).</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- S5 : Les technologies -->
        <div class="guide-section">
          <button class="gs-header" onclick="togGuide(this)">
            <div class="gs-num">5</div>
            <div class="gs-label">Les Technologies (TOOLS) â€” quoi acheter en premier</div>
            <div class="gs-arr">â–¼</div>
          </button>
          <div class="gs-body">
            <p>Il y a plus de 100 technologies dans ACIV. Voici les prioritÃ©s absolues pour dÃ©buter :</p>
            <table class="civ-table">
              <thead><tr><th>TOOL</th><th>CoÃ»t</th><th>Effet</th></tr></thead>
              <tbody>
                <tr><td><strong>Grain</strong></td><td>3</td><td class="str">RÃ©duit la famine. PRIORITÃ‰ 1.</td></tr>
                <tr><td><strong>Pottery</strong></td><td>6</td><td class="str">RÃ©duit les Ã©pidÃ©mies. PRIORITÃ‰ 2.</td></tr>
                <tr><td><strong>Agriculture</strong></td><td>6</td><td>Augmente cap. de population.</td></tr>
                <tr><td><strong>Clothmaking</strong></td><td>6</td><td>Bonus commerce.</td></tr>
                <tr><td><strong>Metalworking</strong></td><td>35</td><td class="str">Fort bonus militaire.</td></tr>
                <tr><td><strong>Astronomy</strong></td><td>20</td><td>Navires Ã  longue portÃ©e.</td></tr>
                <tr><td><strong>Trade</strong></td><td>40</td><td class="str">+2 cartes/tour. Puissant.</td></tr>
                <tr><td><strong>Law</strong></td><td>40</td><td>RÃ©duit anarchie + bonus AST.</td></tr>
                <tr><td><strong>Medicine</strong></td><td>15</td><td>Protection contre Ã©pidÃ©mies.</td></tr>
                <tr><td><strong>Engineering</strong></td><td>60</td><td>Fortifications, citÃ©s rÃ©sistantes.</td></tr>
              </tbody>
            </table>
            <div class="warn-box">
              <div class="wl">âš  Ne nÃ©glige pas les calamitÃ©s</div>
              Les 3 calamitÃ©s les plus dÃ©vastatrices sont : <strong>Famine, Ã‰pidÃ©mie, Guerre civile</strong>. Grain + Pottery + Medicine te protÃ¨gent des deux premiÃ¨res. AchÃ¨te-les dÃ¨s que possible.
            </div>
            <div class="tip-box">
              <div class="tl">ğŸ’¡ Ordre d'achat conseillÃ©</div>
              Tour 1â€“3 : Grain, Pottery, Agriculture. <br>Tour 4â€“6 : Clothmaking, mÃ©decine. <br>Tour 7+ : vise Trade ou Law pour l'AST.
            </div>
          </div>
        </div>

        <!-- S6 : L'AST -->
        <div class="guide-section">
          <button class="gs-header" onclick="togGuide(this)">
            <div class="gs-num">6</div>
            <div class="gs-label">La piste AST â€” comment gagner</div>
            <div class="gs-arr">â–¼</div>
          </button>
          <div class="gs-body">
            <p>L'AST (Advancement of Science Track) est la piste verticale sur le cÃ´tÃ© gauche du plateau. Ton pion commence en bas (Ã‚ge de Pierre) et remonte.</p>
            <div class="rule-box">
              <div class="rl">ğŸ“Œ Condition d'avancement</div>
              Ã€ la fin de chaque tour, tu peux avancer sur l'AST si :<br>
              1. Tu as le nombre de citÃ©s requis pour le niveau suivant.<br>
              2. Tu as acquis les TOOLS requis par ce niveau.<br>
              Les deux conditions doivent Ãªtre remplies simultanÃ©ment.
            </div>
            <ul>
              <li><strong>Ã‚ge de Pierre</strong> â†’ <strong>Ã‚ge du Cuivre</strong> : 2 citÃ©s + Grain ou Pottery.</li>
              <li><strong>Ã‚ge du Cuivre</strong> â†’ <strong>Bronze</strong> : 3â€“4 citÃ©s + plusieurs TOOLS basiques.</li>
              <li><strong>Ã‚ge du Bronze</strong> â†’ <strong>Fer</strong> : 5â€“6 citÃ©s + TOOLS avancÃ©s (Trade, Law, Metalworking...).</li>
            </ul>
            <div class="tip-box">
              <div class="tl">ğŸ’¡ La vraie victoire</div>
              Avance sur l'AST <em>avant</em> de te battre. Un joueur Ã  l'Ã‚ge du Bronze face Ã  un joueur en Ã‚ge de Pierre a un avantage massif en technologie. L'AST est une course â€” pas une guerre.
            </div>
          </div>
        </div>

        <!-- S7 : Profils civ -->
        <div class="guide-section">
          <button class="gs-header" onclick="togGuide(this)">
            <div class="gs-num">7</div>
            <div class="gs-label">Profils des civilisations â€” leurs forces</div>
            <div class="gs-arr">â–¼</div>
          </button>
          <div class="gs-body">
            <table class="civ-table">
              <thead><tr><th>Civ</th><th>Zone dÃ©part</th><th>Force</th><th>Faiblesse</th></tr></thead>
              <tbody>
                <tr><td><strong>Egypt</strong></td><td>VallÃ©e du Nil</td><td class="str">Terres fertiles, expansion facile</td><td class="wk">IsolÃ©e, peu de voisins Ã  trader</td></tr>
                <tr><td><strong>Babylon</strong></td><td>MÃ©sopotamie</td><td class="str">Fort potentiel de population</td><td class="wk">EntourÃ©e de rivaux</td></tr>
                <tr><td><strong>Crete</strong></td><td>Mer Ã‰gÃ©e</td><td class="str">Maritime, commerce naturel</td><td class="wk">Territoire limitÃ©</td></tr>
                <tr><td><strong>Greece</strong></td><td>GrÃ¨ce / Balkans</td><td class="str">Ã‰quilibre pop/commerce</td><td class="wk">Concurrence avec Crete/Thrace</td></tr>
                <tr><td><strong>Carthage</strong></td><td>Afrique du Nord</td><td class="str">AccÃ¨s mer direct, commerce</td><td class="wk">Expansion terrestre difficile</td></tr>
                <tr><td><strong>Italy</strong></td><td>Italie centrale</td><td class="str">Position centrale, pivotal</td><td class="wk">Sous pression de tous</td></tr>
                <tr><td><strong>Illyria</strong></td><td>Balkans Nord</td><td class="str">Territoire vaste</td><td class="wk">Peu de sites de citÃ©s premium</td></tr>
                <tr><td><strong>Thrace</strong></td><td>Mer Noire</td><td class="str">Expansion vers Est</td><td class="wk">Loin des grandes routes commerciales</td></tr>
              </tbody>
            </table>
            <div class="tip-box">
              <div class="tl">ğŸ’¡ Pour dÃ©buter</div>
              Egypt ou Greece sont les plus accessibles. Egypt pour la stratÃ©gie solitaire, Greece pour apprendre le commerce.
            </div>
          </div>
        </div>

        <!-- S8 : StratÃ©gie d'ouverture -->
        <div class="guide-section">
          <button class="gs-header" onclick="togGuide(this)">
            <div class="gs-num">8</div>
            <div class="gs-label">StratÃ©gie d'ouverture â€” les 5 premiers tours</div>
            <div class="gs-arr">â–¼</div>
          </button>
          <div class="gs-body">
            <p>La ouverture dÃ©termine souvent la partie entiÃ¨re. Voici la sÃ©quence gagnante standard :</p>
            <ul>
              <li><strong>Tour 1 :</strong> Ã‰tale ta population sur 3â€“4 territoires. Identifie les sites de citÃ©s rouges proches. Place 3â€“4 tokens dessus.</li>
              <li><strong>Tour 2 :</strong> ComplÃ¨te la course vers tes sites rouges. Mets 6 tokens sur le 1er site. Construit ta 1Ã¨re citÃ© !</li>
              <li><strong>Tour 3 :</strong> Avec ta 1Ã¨re citÃ©, tu reÃ§ois 1 carte. Commence Ã  viser le 2Ã¨me site. AchÃ¨te Grain si tu peux.</li>
              <li><strong>Tour 4 :</strong> 2Ã¨me citÃ©. Commence Ã  trader pour faire des ensembles. AchÃ¨te Pottery.</li>
              <li><strong>Tour 5 :</strong> 3Ã¨me citÃ© si possible. Commence Ã  nÃ©gocer sÃ©rieusement. Vise l'AST prochain niveau.</li>
            </ul>
            <div class="warn-box">
              <div class="wl">âš  Erreurs de dÃ©butant</div>
              <ul>
                <li>Se battre dÃ¨s le dÃ©but. La guerre = pertes des deux cÃ´tÃ©s = retard AST.</li>
                <li>Oublier les capacitÃ©s de territoire (surplus = tokens perdus).</li>
                <li>NÃ©gliger la phase de commerce. Un mauvais trade peut te coÃ»ter la partie.</li>
                <li>Acheter des technologies de prestige avant les technologies de survie.</li>
              </ul>
            </div>
            <div class="tip-box">
              <div class="tl">ğŸ’¡ La rÃ¨gle des 3-3-3</div>
              3 citÃ©s, 3 technologies basiques, 3 ensembles de cartes commerciales = tu es en position solide pour viser la victoire.
            </div>
          </div>
        </div>

      </div><!-- /tGuide -->

      <!-- â”€â”€ ONGLET OBJECTIFS â”€â”€ -->
      <div class="tab-pane" id="tObj">
        <div class="obj-wrap">
          <div class="obj-title">Objectifs de session</div>

          <div class="obj-item" id="o1">
            <span class="obj-ico">ğŸ•</span>
            <div style="flex:1">Jouer 5 minutes</div>
            <div class="obj-xp">+15 XP</div>
          </div>
          <div class="obj-item" id="o2">
            <span class="obj-ico">ğŸ•‘</span>
            <div style="flex:1">Jouer 20 minutes</div>
            <div class="obj-xp">+35 XP</div>
          </div>

          <div class="obj-item" id="o3">
            <span class="obj-ico">ğŸ™</span>
            <div style="flex:1">
              <div>Construire une citÃ©</div>
              <div class="obj-input">
                <input type="text" id="cityIn" placeholder="Code citÃ©">
                <button onclick="validateObj('CITY')">Valider</button>
              </div>
            </div>
            <div class="obj-xp">+25 XP</div>
          </div>

          <div class="obj-item" id="o4">
            <span class="obj-ico">ğŸ“š</span>
            <div style="flex:1">
              <div>AcquÃ©rir une technologie</div>
              <div class="obj-input">
                <input type="text" id="techIn" placeholder="Code techno">
                <button onclick="validateObj('TECH')">Valider</button>
              </div>
            </div>
            <div class="obj-xp">+25 XP</div>
          </div>

          <div class="obj-item" id="o5">
            <span class="obj-ico">âš”ï¸</span>
            <div style="flex:1">
              <div>Survivre Ã  une calamitÃ©</div>
              <div class="obj-input">
                <input type="text" id="calIn" placeholder="Code calamitÃ©">
                <button onclick="validateObj('CAL')">Valider</button>
              </div>
            </div>
            <div class="obj-xp">+20 XP</div>
          </div>

        </div>

        <!-- SESSION RECAP -->
        <div style="padding:10px 13px; border-top:1px solid var(--border); margin-top:4px;">
          <div style="font-family:'Cinzel',serif; font-size:.65rem; color:var(--parchment); text-transform:uppercase; letter-spacing:1px; margin-bottom:8px;">RÃ©capitulatif session</div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:6px;">
            <div style="background:rgba(0,0,0,.3); border:1px solid var(--border); padding:8px; text-align:center;">
              <div style="font-size:.62rem; color:var(--stone);">Temps</div>
              <div style="font-family:'Orbitron',monospace; font-size:.8rem; color:var(--cyan);" id="recapTime">00:00</div>
            </div>
            <div style="background:rgba(0,0,0,.3); border:1px solid var(--border); padding:8px; text-align:center;">
              <div style="font-size:.62rem; color:var(--stone);">XP Session</div>
              <div style="font-family:'Orbitron',monospace; font-size:.8rem; color:var(--gold);" id="recapXP">0</div>
            </div>
          </div>
        </div>

        <!-- NOTE PÃ‰DAGOGIQUE -->
        <div style="padding:10px 13px; background:rgba(200,165,90,0.03); border-top:1px solid rgba(200,165,90,0.12);">
          <div style="font-family:'Cinzel',serif; font-size:.65rem; color:var(--parchment); text-transform:uppercase; letter-spacing:1px; margin-bottom:5px;">Note</div>
          <p style="font-size:.7rem; color:#6a8a68; line-height:1.65;">
            ACIV n'a aucune part de hasard â€” chaque conflit se rÃ©sout par soustraction Ã©gale des deux cÃ´tÃ©s. La dÃ©mo est limitÃ©e Ã  <strong>16 tours</strong>. Pas de sauvegarde.
          </p>
        </div>
      </div><!-- /tObj -->

    </aside><!-- /panelRight -->

  </div><!-- /arena -->
</div><!-- /mainWrap -->

<!-- XP NOTIF -->
<div id="xpNotif">+<span id="xpN">0</span> XP !</div>

<script>
'use strict';
const XP_THRESHOLD = 500;
const GAME_BUNDLE  = 'game/aciv.jsdos';
const SECRET_CITY  = 'CITAIVOK';
const SECRET_TECH  = 'TOOLSAC95';
const SECRET_CAL   = 'CALAMIVY';

const TIPS = [
  'ğŸ’¡ Construis tes citÃ©s dans les cases rouges/jaunes â€” 6 tokens exactement.',
  'ğŸ’¡ Ne te bats pas dÃ¨s le dÃ©but. La guerre coÃ»te autant chez toi que chez l\'adversaire.',
  'ğŸ’¡ AchÃ¨te d\'abord Grain et Pottery â€” les calamitÃ©s peuvent te dÃ©cimer.',
  'ğŸ’¡ NÃ©gocie pour former des triplets de la mÃªme marchandise. Ã‡a vaut 3Ã— plus.',
  'ğŸ’¡ Plus tu as de citÃ©s, plus tes cartes de commerce ont une valeur Ã©levÃ©e.',
  'ğŸ’¡ L\'AST se monte avec des citÃ©s ET des technologies. Les deux Ã  la fois.',
  'ğŸ’¡ Astronomy te donne des navires Ã  longue portÃ©e. Essentiel pour les civs cÃ´tiÃ¨res.',
  'ğŸ’¡ La vraie victoire = avancer sur l\'AST avant les adversaires. Pas les Ã©craser.',
];

const BRIDGE_KEY = 'pvs_bridge_events';
const PLAYER_KEY = 'pvs_current_player';

let cur = '', sessionXP = 0, sessionSec = 0, timerInt = null, tipIdx = 0;
let objectives = {time5:false, time20:false, city:false, tech:false, cal:false};

function nCode(v) {
  return String(v||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim().replace(/\s+/g,'').toUpperCase();
}
function getParam(k) { return new URLSearchParams(window.location.search).get(k)||''; }

function pushBridge(p) {
  try {
    const raw=localStorage.getItem(BRIDGE_KEY);
    const l=raw?JSON.parse(raw):[];
    l.push(p); if(l.length>700)l.splice(0,l.length-700);
    localStorage.setItem(BRIDGE_KEY,JSON.stringify(l));
  } catch(e){}
}
function evId(pfx) { return `${pfx}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`; }

function calcXP(pc) {
  try {
    const e=JSON.parse(localStorage.getItem(BRIDGE_KEY)||'[]');
    if(!Array.isArray(e)) return 0;
    return e.filter(x=>nCode(x.player)===nCode(pc))
      .reduce((s,x)=>s+Number(x.reward||x.offer||x.xp||0),0);
  } catch(e){return 0;}
}

function init() {
  const fp=getParam('player');
  if(fp) localStorage.setItem(PLAYER_KEY,nCode(fp));
  cur=nCode(localStorage.getItem(PLAYER_KEY)||'');

  const xp=calcXP(cur);
  document.getElementById('gPlayer').textContent = cur||'(non connectÃ©)';
  document.getElementById('gCur').textContent    = xp;
  document.getElementById('gThr').textContent    = XP_THRESHOLD;
  document.getElementById('gBar').style.width    = Math.min(100,Math.round(xp/XP_THRESHOLD*100))+'%';

  if(xp >= XP_THRESHOLD || !cur) unlock();
}

function unlock() {
  document.getElementById('xpGate').classList.add('hidden');
  document.getElementById('mainWrap').classList.add('on');
  const xp=calcXP(cur);
  document.getElementById('hPlayer').textContent = cur||'Visiteur';
  document.getElementById('hXP').textContent     = xp;
  startTimer(); rotateTip();
  setInterval(rotateTip, 18000);
  if(cur) pushBridge({id:evId('ACIV_OPEN'),type:'ACIV_OPEN',player:cur,d:new Date().toISOString()});
}

function startTimer() {
  timerInt = setInterval(()=>{
    sessionSec++;
    const m=String(Math.floor(sessionSec/60)).padStart(2,'0');
    const s=String(sessionSec%60).padStart(2,'0');
    const t=`${m}:${s}`;
    document.getElementById('hSess').textContent   = t;
    document.getElementById('bTime').textContent   = t;
    document.getElementById('recapTime').textContent = t;
    if(sessionSec===300  && !objectives.time5)  { objectives.time5=true;  awardXP(15,'TIME5','5 minutes de jeu'); markObj('o1'); }
    if(sessionSec===1200 && !objectives.time20) { objectives.time20=true; awardXP(35,'TIME20','20 minutes de jeu'); markObj('o2'); }
  },1000);
}

function awardXP(amt,type,lbl) {
  sessionXP+=amt;
  document.getElementById('sessXP').textContent   = sessionXP;
  document.getElementById('recapXP').textContent  = sessionXP;
  document.getElementById('hXP').textContent      = calcXP(cur)+sessionXP;
  if(cur) pushBridge({id:evId('ACIV_XP'),type:'ACIV_XP',player:cur,subtype:type,label:lbl,reward:amt,d:new Date().toISOString()});
  showNotif(amt);
}

function showNotif(v) {
  const n=document.getElementById('xpNotif');
  document.getElementById('xpN').textContent=v;
  n.style.display='block';
  setTimeout(()=>n.style.display='none',2500);
}

function markObj(id) {
  const el=document.getElementById(id);
  if(el) { el.classList.add('obj-done'); el.querySelector('.obj-ico').textContent='âœ…'; }
}

function validateObj(type) {
  const secrets = {CITY:SECRET_CITY, TECH:SECRET_TECH, CAL:SECRET_CAL};
  const inputs  = {CITY:'cityIn', TECH:'techIn', CAL:'calIn'};
  const objIds  = {CITY:'o3', TECH:'o4', CAL:'o5'};
  const labels  = {CITY:'CitÃ© construite', TECH:'Technologie acquise', CAL:'CalamitÃ© survÃ©cue'};
  const xps     = {CITY:25, TECH:25, CAL:20};
  const stats   = {CITY:'bCit', TECH:'bTool'};
  const doneKey = {CITY:'city', TECH:'tech', CAL:'cal'};

  const code=nCode(document.getElementById(inputs[type]).value);
  if(code!==nCode(secrets[type])) { alert('Code incorrect. Demande-le au CPE aprÃ¨s avoir accompli l\'action dans le jeu.'); return; }
  if(objectives[doneKey[type]]) { alert('Objectif dÃ©jÃ  validÃ© !'); return; }
  objectives[doneKey[type]]=true;
  if(stats[type]) {
    const el=document.getElementById(stats[type]);
    if(el) el.textContent=parseInt(el.textContent||'0')+1;
  }
  awardXP(xps[type],type,labels[type]);
  markObj(objIds[type]);
}

/* ACCORDION encyclopÃ©die (panneau gauche) */
function togAcc(btn) {
  const body=btn.nextElementSibling;
  const was=btn.classList.contains('on');
  document.querySelectorAll('.acc-btn.on').forEach(b=>{b.classList.remove('on');b.nextElementSibling.classList.remove('on');});
  if(!was){btn.classList.add('on');body.classList.add('on');}
}

/* ACCORDION guide (panneau droit) */
function togGuide(btn) {
  const body=btn.nextElementSibling;
  const was=btn.classList.contains('on');
  document.querySelectorAll('.gs-header.on').forEach(b=>{b.classList.remove('on');b.nextElementSibling.classList.remove('on');});
  if(!was){btn.classList.add('on');body.classList.add('on');}
}

/* TABS panneau droit */
function switchTab(btn, id) {
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('on'));
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('on'));
  btn.classList.add('on');
  document.getElementById(id).classList.add('on');
}

/* TIPS */
function rotateTip() {
  document.getElementById('tipT').textContent=TIPS[tipIdx%TIPS.length];
  tipIdx++;
}

/* PANNEAUX TOGGLE */
let pv=true;
function togglePanels() {
  pv=!pv;
  ['panelLeft','panelRight'].forEach(id=>{
    document.getElementById(id).style.display=pv?'':'none';
  });
}

/* PLEIN Ã‰CRAN */
function expandGame() {
  const el=document.getElementById('dosWrap');
  if(el.requestFullscreen) el.requestFullscreen();
}

/* CHARGEMENT JS-DOS */
function loadGame() {
  const btn=document.getElementById('btnLoad');
  btn.textContent='â³ Chargementâ€¦'; btn.disabled=true;
  const sc=document.createElement('script');
  sc.src='https://v8.js-dos.com/8.0.0/js-dos.js';
  sc.onload=initJsDos;
  sc.onerror=()=>{btn.textContent='â–¶ Lancer';btn.disabled=false;alert('js-dos indisponible. VÃ©rifiez votre connexion.');};
  document.head.appendChild(sc);
}

function initJsDos() {
  document.getElementById('gameLoading').style.display='none';
  const mount=document.getElementById('jsdosMount');
  mount.style.display='block';
  try {
    const canvas=document.createElement('canvas');
    canvas.style.cssText='width:100%;height:100%;max-width:800px;max-height:600px;display:block;margin:auto;';
    mount.appendChild(canvas);
    Dos(canvas,{wdosboxUrl:'https://v8.js-dos.com/8.0.0/wdosbox.js'}).ready((fs,main)=>{
      fs.extract(GAME_BUNDLE).then(()=>main(['-c','C:','-c','ACIV.EXE']))
        .catch(()=>showErr(`Bundle ${GAME_BUNDLE} introuvable. Voir README.`));
    });
    document.getElementById('btnLoad').textContent='âœ… LancÃ©';
  } catch(e){showErr('Erreur js-dos: '+e.message);}
}

function showErr(msg) {
  document.getElementById('jsdosMount').style.display='none';
  const g=document.getElementById('gameLoading');
  g.style.display='flex';
  g.innerHTML=`<div style="font-size:.8rem;color:#aa4;max-width:300px;text-align:center;line-height:1.7;">${msg}</div>
    <button onclick="location.reload()" style="margin-top:12px;padding:7px 16px;background:rgba(0,212,255,.08);border:1px solid rgba(0,212,255,.25);color:var(--cyan);cursor:pointer;">RÃ©essayer</button>`;
  document.getElementById('btnLoad').textContent='â–¶ Lancer';
  document.getElementById('btnLoad').disabled=false;
}

function goPortal() {
  const s=cur?`?player=${encodeURIComponent(cur)}`:'';
  window.location.href=`index_PIX_DELEGUES.html${s}`;
}

window.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
