<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L'Ordre des Ã‰cuyers â€” BibliothÃ¨que de Valdurne</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=IM+Fell+English:ital@0;1&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --or:       #c9a84c;
  --or-clair: #e8c97a;
  --or-sombre:#8a6a1f;
  --encre:    #e8dfc8;
  --encre-2:  #c8bfa8;
  --parchemin:#120e0a;
  --parchemin-2:#1e1710;
  --parchemin-3:#2a2218;
  --rouge:    #7a2020;
  --bleu-nuit:#0e1522;
  --vert:     #1a3a1a;
  --violet:   #2a1a3a;
  --neon:     rgba(201,168,76,0.15);
  --glow:     0 0 20px rgba(201,168,76,0.3);
  --radius:   8px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{
  background:var(--parchemin);
  color:var(--encre);
  font-family:'Crimson Text',Georgia,serif;
  font-size:1.05em;
  line-height:1.75;
  min-height:100vh;
  overflow-x:hidden;
}

/* â”€â”€ Texture de fond â”€â”€ */
body::before{
  content:'';
  position:fixed;inset:0;z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 60% 40% at 20% 20%, rgba(139,42,42,0.06) 0%, transparent 60%),
    radial-gradient(ellipse 50% 60% at 80% 80%, rgba(42,42,139,0.06) 0%, transparent 60%),
    radial-gradient(ellipse 40% 30% at 50% 50%, rgba(201,168,76,0.03) 0%, transparent 70%);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PORTAIL D'AUTHENTIFICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#authGate{
  position:fixed;inset:0;z-index:9000;
  background:var(--parchemin);
  display:flex;align-items:center;justify-content:center;
}
#authGate.hidden{display:none}

.auth-card{
  width:min(480px,92vw);
  background:var(--parchemin-2);
  border:1px solid rgba(201,168,76,0.35);
  border-radius:12px;
  padding:40px 36px;
  text-align:center;
  box-shadow:0 0 60px rgba(0,0,0,0.6),0 0 20px rgba(201,168,76,0.1);
  animation:card-appear 0.6s ease;
}
@keyframes card-appear{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}

.auth-rune{
  font-size:2.5em;margin-bottom:16px;
  filter:drop-shadow(0 0 12px rgba(201,168,76,0.5));
}
.auth-title{
  font-family:'Cinzel',serif;font-size:1.4em;font-weight:700;
  color:var(--or-clair);letter-spacing:2px;margin-bottom:6px;
}
.auth-sub{
  font-style:italic;color:var(--encre-2);font-size:0.9em;margin-bottom:28px;opacity:0.75;
}
.auth-locked{
  background:rgba(122,32,32,0.15);border:1px solid rgba(122,32,32,0.4);
  border-radius:6px;padding:14px;margin-bottom:24px;
  font-size:0.85em;color:#e88;line-height:1.6;display:none;
}
.auth-locked.visible{display:block}

.auth-input{
  width:100%;padding:12px 16px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(201,168,76,0.3);
  border-radius:6px;
  color:var(--encre);font-family:'Crimson Text',serif;font-size:1em;
  text-align:center;letter-spacing:2px;text-transform:uppercase;
  outline:none;transition:border-color 0.2s,box-shadow 0.2s;
  margin-bottom:16px;
}
.auth-input:focus{border-color:var(--or);box-shadow:var(--glow)}
.auth-input::placeholder{letter-spacing:1px;text-transform:none;opacity:0.5}

.btn-primary{
  width:100%;padding:12px;
  background:linear-gradient(135deg,rgba(201,168,76,0.25),rgba(201,168,76,0.1));
  border:1px solid var(--or);border-radius:6px;
  color:var(--or-clair);font-family:'Cinzel',serif;
  font-size:0.85em;letter-spacing:2px;cursor:pointer;
  transition:all 0.2s;
}
.btn-primary:hover{background:rgba(201,168,76,0.35);box-shadow:var(--glow)}
.auth-msg{margin-top:12px;font-size:0.82em;min-height:1.4em;color:#e88}
.auth-xp-missing{
  margin-top:16px;padding:12px;
  background:rgba(201,168,76,0.06);border:1px solid rgba(201,168,76,0.2);
  border-radius:6px;font-size:0.82em;color:var(--encre-2);
  font-style:italic;display:none;
}
.auth-xp-missing.visible{display:block}
.back-link{
  display:inline-block;margin-top:20px;
  color:var(--encre-2);font-size:0.8em;opacity:0.6;cursor:pointer;
  text-decoration:none;transition:opacity 0.2s;
}
.back-link:hover{opacity:1;color:var(--or)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EN-TÃŠTE DU HUB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#hubMain{display:none}
#hubMain.visible{display:block}

.hub-header{
  position:relative;z-index:1;
  padding:40px 24px 0;
  max-width:1100px;margin:0 auto;
}
.hub-tag{
  font-family:'Cinzel',serif;font-size:0.65em;letter-spacing:5px;
  color:var(--or);opacity:0.7;text-transform:uppercase;margin-bottom:10px;
}
.hub-title{
  font-family:'Cinzel',serif;font-size:clamp(1.8em,5vw,2.8em);
  font-weight:700;color:var(--or-clair);
  text-shadow:0 0 40px rgba(201,168,76,0.3);
  line-height:1.2;margin-bottom:6px;
}
.hub-sub{
  font-style:italic;color:var(--encre-2);opacity:0.7;
  font-size:1em;margin-bottom:20px;
}
.hub-player-bar{
  display:flex;align-items:center;gap:16px;flex-wrap:wrap;
  padding:12px 16px;
  background:rgba(201,168,76,0.04);
  border:1px solid rgba(201,168,76,0.15);
  border-radius:6px;margin-bottom:32px;
  font-size:0.82em;
}
.hpb-item{color:var(--encre-2)}
.hpb-val{color:var(--or-clair);font-weight:600;margin-left:4px}
.hpb-sep{color:rgba(201,168,76,0.3)}
.btn-logout{
  margin-left:auto;padding:5px 14px;
  background:transparent;border:1px solid rgba(201,168,76,0.25);
  border-radius:4px;color:var(--encre-2);font-size:0.85em;cursor:pointer;
  transition:all 0.2s;
}
.btn-logout:hover{border-color:var(--or);color:var(--or)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GRILLE BIBLIOTHÃˆQUE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.library{
  max-width:1100px;margin:0 auto;
  padding:0 24px 60px;
  position:relative;z-index:1;
}

.pillar-section{margin-bottom:40px}
.pillar-label{
  font-family:'Cinzel',serif;font-size:0.7em;letter-spacing:4px;
  color:var(--or);text-transform:uppercase;margin-bottom:16px;
  padding-bottom:8px;border-bottom:1px solid rgba(201,168,76,0.2);
  display:flex;align-items:center;gap:10px;
}
.pillar-label::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(201,168,76,0.2),transparent)}

.cards-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:16px;
}

/* â”€â”€ Carte chapitre/sÃ©quence â”€â”€ */
.story-card{
  background:var(--parchemin-2);
  border:1px solid rgba(201,168,76,0.2);
  border-radius:var(--radius);
  padding:20px;
  transition:transform 0.2s,border-color 0.2s,box-shadow 0.2s;
  position:relative;overflow:hidden;
  cursor:default;
}
.story-card.unlocked{cursor:pointer}
.story-card.unlocked:hover{
  transform:translateY(-3px);
  border-color:rgba(201,168,76,0.5);
  box-shadow:0 8px 30px rgba(0,0,0,0.4),0 0 12px rgba(201,168,76,0.15);
}
.story-card.locked{opacity:0.5;filter:grayscale(0.4)}
.story-card.completed{border-color:rgba(201,168,76,0.4)}
.story-card.completed::after{
  content:'âœ“';
  position:absolute;top:12px;right:12px;
  font-size:0.75em;color:var(--or);opacity:0.7;
}
/* Ligne colorÃ©e en haut selon le pilier */
.story-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,var(--card-accent,var(--or)),transparent);
}

.sc-icon{font-size:1.8em;margin-bottom:10px;display:block}
.sc-title{
  font-family:'Cinzel',serif;font-size:0.9em;font-weight:600;
  color:var(--or-clair);line-height:1.3;margin-bottom:4px;
}
.sc-meta{font-size:0.72em;color:var(--encre-2);opacity:0.65;margin-bottom:10px}
.sc-excerpt{
  font-style:italic;font-size:0.82em;color:var(--encre-2);
  line-height:1.65;border-left:2px solid rgba(201,168,76,0.2);
  padding-left:10px;margin-bottom:14px;
}
.sc-locked-hint{
  font-size:0.75em;color:#888;font-style:italic;margin-bottom:12px;
}
.sc-footer{
  display:flex;align-items:center;justify-content:space-between;
  flex-wrap:wrap;gap:8px;
}
.sc-badge{
  font-size:0.7em;color:var(--or);opacity:0.8;
}
.sc-cta{
  display:inline-block;padding:5px 14px;
  background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.4);
  border-radius:4px;color:var(--or-clair);font-size:0.75em;
  letter-spacing:1px;transition:background 0.2s;
}
.sc-cta:hover{background:rgba(201,168,76,0.25)}

/* â”€â”€ Badge EVENT â”€â”€ */
.event-ribbon{
  position:absolute;top:12px;right:12px;
  background:linear-gradient(135deg,var(--rouge),#3a0a5a);
  border:1px solid var(--or);border-radius:3px;
  padding:2px 8px;font-size:0.65em;
  color:var(--or-clair);letter-spacing:1px;
  font-family:'Cinzel',serif;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALE LDVELH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#ldvelhModal{
  position:fixed;inset:0;z-index:9500;
  background:rgba(10,8,5,0.97);
  display:none;flex-direction:column;
  overflow-y:auto;
}
#ldvelhModal.open{display:flex}

.ldvelh-header{
  padding:20px 24px 0;
  max-width:740px;margin:0 auto;width:100%;
  display:flex;align-items:center;gap:16px;
}
.ldvelh-close{
  margin-left:auto;padding:7px 16px;
  background:transparent;border:1px solid rgba(201,168,76,0.3);
  border-radius:4px;color:var(--encre-2);cursor:pointer;
  font-size:0.8em;transition:all 0.2s;flex-shrink:0;
}
.ldvelh-close:hover{border-color:var(--or);color:var(--or)}
.ldvelh-chapter-name{
  font-family:'Cinzel',serif;font-size:0.8em;
  color:var(--or);letter-spacing:2px;opacity:0.8;
}

.ldvelh-body{
  max-width:740px;margin:0 auto;padding:32px 24px 60px;width:100%;
  flex:1;
}

/* â”€â”€ Passage LDVELH â”€â”€ */
.passage{display:none;animation:passage-in 0.4s ease}
.passage.active{display:block}
@keyframes passage-in{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

.passage-num{
  font-family:'Cinzel',serif;font-size:0.65em;letter-spacing:3px;
  color:var(--or);opacity:0.5;margin-bottom:20px;
}
.passage-text{
  font-size:1.1em;line-height:1.9;margin-bottom:28px;
}
.passage-text p{margin-bottom:1.2em;text-align:justify}
.passage-text em{font-style:italic;color:var(--encre-2)}

/* Illustration mood (emoji large centrÃ©) */
.passage-mood{
  text-align:center;font-size:3em;margin:20px 0;
  filter:drop-shadow(0 0 16px rgba(201,168,76,0.4));
}

.passage-divider{
  border:none;border-top:1px solid rgba(201,168,76,0.15);
  margin:20px 0;
}

/* â”€â”€ Boutons de choix â”€â”€ */
.choices{display:flex;flex-direction:column;gap:10px;margin-top:24px}
.choice-btn{
  width:100%;padding:14px 18px;text-align:left;
  background:rgba(201,168,76,0.05);
  border:1px solid rgba(201,168,76,0.25);
  border-radius:6px;
  color:var(--encre);font-family:'Crimson Text',serif;
  font-size:1em;line-height:1.5;cursor:pointer;
  transition:all 0.2s;position:relative;
}
.choice-btn::before{
  content:'â–¸';color:var(--or);margin-right:10px;opacity:0.6;
}
.choice-btn:hover{
  background:rgba(201,168,76,0.12);
  border-color:rgba(201,168,76,0.5);
  color:var(--or-clair);
  transform:translateX(4px);
}
.choice-btn:disabled{opacity:0.4;cursor:not-allowed;transform:none}

/* â”€â”€ RÃ©sultat final â”€â”€ */
.result-block{
  margin-top:24px;padding:24px;
  border-radius:8px;text-align:center;
}
.result-block.success{
  background:linear-gradient(135deg,rgba(26,58,26,0.6),rgba(42,74,26,0.4));
  border:1px solid rgba(100,180,100,0.4);
}
.result-block.failure{
  background:linear-gradient(135deg,rgba(58,26,26,0.6),rgba(74,42,26,0.4));
  border:1px solid rgba(180,80,80,0.4);
}
.result-icon{font-size:2.5em;margin-bottom:12px;display:block}
.result-title{
  font-family:'Cinzel',serif;font-size:1em;margin-bottom:8px;
  letter-spacing:1px;
}
.result-block.success .result-title{color:#8fe888}
.result-block.failure .result-title{color:#e88888}
.result-xp{font-size:1.2em;font-weight:600;margin:10px 0}
.result-block.success .result-xp{color:#b8e8b8}
.result-block.failure .result-xp{color:#e8b8b8}
.result-text{font-size:0.88em;color:var(--encre-2);line-height:1.6;margin-bottom:16px}
.btn-retry{
  padding:10px 24px;
  background:rgba(201,168,76,0.1);border:1px solid var(--or);
  border-radius:4px;color:var(--or-clair);cursor:pointer;
  font-family:'Cinzel',serif;font-size:0.8em;letter-spacing:1px;
  transition:all 0.2s;margin-right:8px;
}
.btn-retry:hover{background:rgba(201,168,76,0.25)}
.btn-close-result{
  padding:10px 24px;
  background:transparent;border:1px solid rgba(255,255,255,0.15);
  border-radius:4px;color:var(--encre-2);cursor:pointer;
  font-size:0.8em;transition:all 0.2s;
}
.btn-close-result:hover{border-color:rgba(255,255,255,0.4);color:var(--encre)}

/* â”€â”€ Barre de progression LDVELH â”€â”€ */
.ldvelh-progress{
  display:flex;gap:4px;margin-bottom:28px;align-items:center;
}
.prog-step{
  height:3px;flex:1;border-radius:2px;
  background:rgba(201,168,76,0.15);
  transition:background 0.3s;
}
.prog-step.done{background:rgba(201,168,76,0.7)}
.prog-step.current{background:var(--or)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIF XP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.xp-notif{
  position:fixed;top:20px;left:50%;transform:translateX(-50%);
  z-index:9999;padding:12px 28px;
  border-radius:8px;font-weight:600;font-size:0.95em;
  text-align:center;pointer-events:none;
  animation:notif-in 0.4s ease, notif-out 0.5s ease 4s forwards;
}
.xp-notif.success{
  background:linear-gradient(135deg,#1a3a1a,#2a4a1a);
  border:1px solid rgba(100,200,100,0.5);color:#b8e8b8;
  box-shadow:0 0 20px rgba(100,200,100,0.3);
}
.xp-notif.fail{
  background:linear-gradient(135deg,#3a1a1a,#4a1a1a);
  border:1px solid rgba(200,80,80,0.5);color:#e8b8b8;
  box-shadow:0 0 20px rgba(200,80,80,0.3);
}
@keyframes notif-in{from{opacity:0;top:0}to{opacity:1;top:20px}}
@keyframes notif-out{from{opacity:1}to{opacity:0;pointer-events:none}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR PERSONNALISÃ‰E
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:var(--parchemin)}
::-webkit-scrollbar-thumb{background:rgba(201,168,76,0.3);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:rgba(201,168,76,0.5)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:600px){
  .hub-header,.library{padding-left:14px;padding-right:14px}
  .hub-title{font-size:1.6em}
  .ldvelh-body{padding:20px 14px 40px}
  .passage-text{font-size:1em}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PORTAIL D'AUTHENTIFICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="authGate">
  <div class="auth-card">
    <div class="auth-rune">ğŸ“–</div>
    <h1 class="auth-title">BibliothÃ¨que de Valdurne</h1>
    <p class="auth-sub">L'Ordre des Ã‰cuyers de ChÃ¢teau-Rance</p>

    <div class="auth-locked" id="authLocked">
      <strong>AccÃ¨s restreint.</strong><br>
      Cette bibliothÃ¨que nÃ©cessite d'avoir atteint <strong>200 XP</strong> dans le Portail Vie Scolaire.<br>
      Continue tes actions pour dÃ©bloquer l'histoire de Lyam.
    </div>

    <input class="auth-input" id="codeInput" placeholder="Ton code joueur" autocomplete="off">
    <button class="btn-primary" onclick="tryLogin()">Entrer dans la BibliothÃ¨que â–¸</button>
    <div class="auth-msg" id="authMsg"></div>

    <div class="auth-xp-missing" id="xpMissing"></div>

    <a class="back-link" href="index.html">â† Retourner au Portail Vie Scolaire</a>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HUB PRINCIPAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="hubMain">

  <!-- En-tÃªte -->
  <div class="hub-header">
    <div class="hub-tag">ChÃ¢teau-Ã‰cole de Valdurne Â· Saison I</div>
    <h1 class="hub-title">L'Ordre des Ã‰cuyers</h1>
    <p class="hub-sub">Une bibliothÃ¨que qui grandit avec toi. Chaque pilier rÃ©solu ouvre une nouvelle porte.</p>

    <div class="hub-player-bar">
      <span class="hpb-item">Ã‰cuyer : <span class="hpb-val" id="playerName">â€”</span></span>
      <span class="hpb-sep">Â·</span>
      <span class="hpb-item">XP : <span class="hpb-val" id="playerXP">0</span></span>
      <span class="hpb-sep">Â·</span>
      <span class="hpb-item">Chapitres lus : <span class="hpb-val" id="chaptersRead">0</span></span>
      <button class="btn-logout" onclick="logout()">Quitter</button>
    </div>
  </div>

  <div class="library">

    <!-- â”€â”€ PILIER 1 : Histoire Principale â”€â”€ -->
    <div class="pillar-section">
      <div class="pillar-label">ğŸ“š Histoire Principale â€” La PremiÃ¨re AnnÃ©e</div>
      <div class="cards-grid" id="mainStoryGrid"></div>
    </div>

    <!-- â”€â”€ PILIER 2 : SÃ©quences Satellites (LDVELH) â”€â”€ -->
    <div class="pillar-section">
      <div class="pillar-label">âš”ï¸ SÃ©quences de Valdurne â€” Tu es le hÃ©ros</div>
      <div class="cards-grid" id="satelliteGrid"></div>
    </div>

  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODALE LDVELH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="ldvelhModal" role="dialog" aria-modal="true">
  <div class="ldvelh-header">
    <span class="ldvelh-chapter-name" id="ldvelhTitle">SÃ©quence de Valdurne</span>
    <button class="ldvelh-close" onclick="closeLdvelh()">âœ• Fermer</button>
  </div>
  <div class="ldvelh-body">
    <div class="ldvelh-progress" id="ldvelhProgress"></div>
    <div id="ldvelhContent"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIGURATION â€” DOIT CORRESPONDRE AU SUPERHUB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const KEY               = 'pvs_hof_v2';          // clÃ© localStorage S
const ACTIVE_PLAYER_KEY = 'pvs_current_player';   // code joueur actif
const XP_PENDING_KEY    = 'pvs_narration_xp';     // pont XP vers superhub
const NARRATION_DONE    = 'pvs_narration_done';   // sÃ©quences terminÃ©es
const XP_MIN_ACCESS     = 200;                    // XP pour entrer
const XP_BON_CHOIX      = 50;
const XP_MAUVAIS_CHOIX  = -25;
const VISITOR_CODE      = 'VISITEUR-VIESCOLAIRE-CHATEAURANCE';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILITAIRES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nCode(v){
  return String(v||'').trim().toUpperCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/\s+/g,'');
}
function getS(){
  try{return JSON.parse(localStorage.getItem(KEY)||'{}')}catch{return{}}
}
function saveS(S){
  try{localStorage.setItem(KEY,JSON.stringify(S))}catch(e){console.warn('Save failed',e)}
}
function getPlayer(code){
  const S=getS();
  return S.players&&S.players[code]?S.players[code]:null;
}
function xpGlobal(p){
  if(!p)return 0;
  const citizen=(Number(p.socialG||0)+Number(p.wBonusG||0))*10;
  const video=Number(p.videoG||0)*5;
  const acad=(p.acadDone&&typeof p.acadDone==='object'?Object.keys(p.acadDone).length:Number(p.acadDone||0))*15;
  const malus=Number(p.malusG||0);
  return Math.max(0,citizen+video+acad+malus);
}
function getDone(){
  try{return JSON.parse(localStorage.getItem(NARRATION_DONE)||'{}')}catch{return{}}
}
function markDone(id){
  const d=getDone();d[id]=1;
  localStorage.setItem(NARRATION_DONE,JSON.stringify(d));
}
function isDone(id){return !!getDone()[id]}

// â”€â”€ CrÃ©dit XP via le pont localStorage â”€â”€
function creditXP(code,amount,reason){
  if(!code||code===VISITOR_CODE)return;
  const S=getS();
  if(!S.players||!S.players[code])return;
  const p=S.players[code];
  const now=new Date().toISOString();
  // Ajouter au log S.logs
  if(!Array.isArray(S.logs))S.logs=[];
  S.logs.unshift({d:now,p:code,t:reason,target:'NARRATION',xp:Number(amount)});
  if(S.logs.length>700)S.logs.length=700;
  // Appliquer le XP
  if(amount>0){
    p.wBonusG=(Number(p.wBonusG||0)+(amount/10));
    p.wBonusW=(Number(p.wBonusW||0)+(amount/10));
  } else {
    // PÃ©nalitÃ© â†’ malus
    p.malusG=(Number(p.malusG||0)+amount);
    p.malusW=(Number(p.malusW||0)+amount);
  }
  p.up=now;
  saveS(S);
  // Signal pour le superhub (s'il est ouvert)
  const pending=JSON.parse(localStorage.getItem(XP_PENDING_KEY)||'[]');
  pending.push({code,amount,reason,d:now});
  localStorage.setItem(XP_PENDING_KEY,JSON.stringify(pending));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTHENTIFICATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentCode='';

function tryLogin(){
  const raw=document.getElementById('codeInput').value;
  const code=nCode(raw);
  if(!code){setMsg('Entrez votre code joueur.');return}

  const p=getPlayer(code);
  // Permettre le visiteur
  if(code===nCode(VISITOR_CODE)){
    openHub(code,p||{code,socialG:0,wBonusG:0,videoG:0,malusG:0,acadDone:{}});
    return;
  }
  if(!p){setMsg('Code joueur introuvable. Connecte-toi d\'abord dans le Portail Vie Scolaire.');return}

  const xp=xpGlobal(p);
  if(xp<XP_MIN_ACCESS){
    document.getElementById('xpMissing').textContent=
      `Tes XP actuels : ${xp} / ${XP_MIN_ACCESS} requis. Continue tes actions dans le Portail !`;
    document.getElementById('xpMissing').classList.add('visible');
    document.getElementById('authLocked').classList.add('visible');
    setMsg('');
    return;
  }
  openHub(code,p);
}

function openHub(code,p){
  currentCode=code;
  document.getElementById('authGate').classList.add('hidden');
  document.getElementById('hubMain').classList.add('visible');
  renderHub(p);
}

function logout(){
  currentCode='';
  document.getElementById('authGate').classList.remove('hidden');
  document.getElementById('hubMain').classList.remove('visible');
  document.getElementById('codeInput').value='';
}

function setMsg(m){document.getElementById('authMsg').textContent=m}

// Auto-login si code stockÃ©
(function(){
  const stored=localStorage.getItem(ACTIVE_PLAYER_KEY);
  if(stored){
    const code=nCode(stored);
    const p=getPlayer(code);
    if(p&&xpGlobal(p)>=XP_MIN_ACCESS){openHub(code,p);return}
    if(code===nCode(VISITOR_CODE)){openHub(code,p||{});return}
    document.getElementById('codeInput').value=stored;
  }
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDU HUB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHub(p){
  const xp=xpGlobal(p);
  document.getElementById('playerName').textContent=currentCode;
  document.getElementById('playerXP').textContent=xp;

  const d=getDone();
  let chapCount=Object.values(d).filter(v=>v).length;
  document.getElementById('chaptersRead').textContent=chapCount;

  renderMainStory(p,xp);
  renderSatellites(p);
}

// â”€â”€ HISTOIRE PRINCIPALE â”€â”€
const MAIN_CHAPTERS=[
  {
    id:'main_prologue',icon:'ğŸ°',
    title:'Prologue â€” L\'ArrivÃ©e',
    meta:'DÃ©bloquÃ© dÃ¨s le dÃ©but Â· Chapitre gratuit',
    excerpt:'Lyam arrive au ChÃ¢teau-Ã‰cole de Valdurne. Il ne connaÃ®t personne. Dans la grande salle bruissante, un autre Ã©cuyer lui sourit depuis un coin.',
    badge:null,
    minXP:0,
    text:[
      `La grande salle de Valdurne sentait la cire et la pierre ancienne.`,
      `Lyam posa son sac contre le mur du fond â€” le plus loin possible de tous les autres â€” et regarda. Des dizaines d'Ã©cuyers de premiÃ¨re annÃ©e, certains avec des familles qui les embrassaient, d'autres qui riaient dÃ©jÃ  en petits groupes constituÃ©s avant mÃªme d'Ãªtre arrivÃ©s. Il ne reconnaissait personne.`,
      `Il ne savait pas encore que c'Ã©tait Ã§a, le vrai enseignement de Valdurne. Pas les cours de stratÃ©gie ou les exercices au champ. L'apprentissage de <em>comment Ãªtre avec les autres</em> quand personne ne te connaÃ®t encore.`,
      `Un Ã©cuyer dans le coin opposÃ© leva les yeux de son livre et lui fit un signe de tÃªte. Juste Ã§a â€” un signe de tÃªte. Mais dans ce moment prÃ©cis, dans cette salle trop grande et trop bruyante, Ã§a avait suffi.`,
      `Son nom Ã©tait RÃ©na. Ce serait son premier alliÃ©. Peut-Ãªtre le plus important de tous.`,
    ],
    endNote:'La premiÃ¨re annÃ©e commence. D\'autres chapitres s\'ouvriront Ã  mesure que tu progresseras dans le Portail.'
  },
  {
    id:'main_ch1',icon:'âš”ï¸',
    title:'Chapitre I â€” Le TÃ©moin',
    meta:'DÃ©bloquÃ© Ã  100 XP',
    excerpt:'Lyam voit RÃ©na cernÃ© par trois Ã©cuyers. Tout le monde dÃ©tourne les yeux. Il a deux chemins devant lui.',
    badge:null,
    minXP:100,
    text:[
      `Ã‡a s'est passÃ© un mercredi, aprÃ¨s l'entraÃ®nement aux cartes.`,
      `Lyam avait pris le couloir du bas â€” plus court, moins frÃ©quentÃ©. C'est lÃ  qu'il les avait vus : trois Ã©cuyers de deuxiÃ¨me annÃ©e encerclant RÃ©na contre le mur de pierre. Ils ne le frappaient pas. Ils faisaient pire : ils lui parlaient Ã  voix basse, avec ce ton particulier qui n'est pas de la violence mais qui lui ressemble trait pour trait.`,
      `RÃ©na regardait le sol. Il y avait une honte dans ses Ã©paules que Lyam reconnut immÃ©diatement â€” il l'avait portÃ©e lui-mÃªme, Ã  l'Ã©cole d'avant.`,
      `Il s'arrÃªta. Personne d'autre dans le couloir. Les trois Ã©cuyers ne l'avaient pas encore vu. Il pouvait passer par le couloir du haut, prendre dix minutes de plus, et ne jamais avoir Ã  dÃ©cider quoi que ce soit.`,
      `Il ne prit pas le couloir du haut.`,
      `Il s'avanÃ§a, pas sÃ»r de lui du tout, et dit simplement Ã  haute voix : <em>Â« HÃ©, RÃ©na. MaÃ®tre Aldric te cherchait. Â»</em> C'Ã©tait faux. Mais dans la seconde qui suivit, les trois Ã©cuyers s'Ã©cartÃ¨rent, et RÃ©na put s'en aller.`,
      `Plus tard, Lyam se demanda si c'Ã©tait du courage. Il conclut que non â€” il n'avait pas eu le temps d'avoir peur. C'Ã©tait juste une dÃ©cision. Rapide. Ordinaire. Comme en prendre des centaines d'autres chaque jour, sauf que celle-lÃ  comptait vraiment.`,
    ],
    endNote:'ÃŠtre tÃ©moin, c\'est dÃ©jÃ  agir. La suite au Chapitre II â€” dÃ©bloquÃ© Ã  300 XP.'
  },
  {
    id:'main_ch2',icon:'ğŸ“œ',
    title:'Chapitre II â€” La RÃ¨gle du ChÃ¢teau',
    meta:'DÃ©bloquÃ© Ã  300 XP',
    excerpt:'Un conflit Ã©clate entre deux maisons. Les rÃ¨gles de Valdurne sont floues, et certains le savent trÃ¨s bien.',
    badge:null,
    minXP:300,
    text:[
      `La dispute entre la Maison Argent et la Maison Bois avait commencÃ© pour une raison idiote â€” un banc dans le rÃ©fectoire â€” et avait escaladÃ© jusqu'Ã  devenir un incident officiel.`,
      `Le Doyen Ferraud convoqua les deux maisons dans la grande salle. Lyam observait depuis le fond. Ce qui le frappa, ce n'Ã©tait pas la dispute. C'Ã©tait comment certains Ã©cuyers â€” les plus anciens, ceux qui connaissaient le Codex â€” manipulaient les rÃ¨gles avec une prÃ©cision chirurgicale. Ils ne mentaient pas. Ils choisissaient quelles rÃ¨gles citer, et lesquelles oublier.`,
      `<em>Â« Comprendre les rÃ¨gles, c'est du pouvoir Â»</em>, lui dit RÃ©na Ã  voix basse. <em>Â« Mais les utiliser pour Ã©craser les autres, c'est de la lÃ¢chetÃ©. Â»</em>`,
      `Ce soir-lÃ , Lyam emprunta le Codex Ã  la bibliothÃ¨que pour la premiÃ¨re fois. Pas pour gagner. Pour comprendre.`,
      `Il y passa la nuit. Le lendemain matin, il savait exactement quels articles la Maison Argent avait omis de mentionner. Il ne le dit pas Ã  voix haute â€” ce n'Ã©tait pas Ã  lui de trancher. Mais il le nota, soigneusement, et le remit au Doyen sans son nom dessus.`,
      `Ferraud le regarda par-dessus ses lunettes. Il savait trÃ¨s bien d'oÃ¹ venait le parchemin. Il ne dit rien. Mais le lendemain, le jugement fut juste.`,
    ],
    endNote:'La connaissance des rÃ¨gles protÃ¨ge. La suite â€” Chapitre III â€” Ã  500 XP.'
  },
  {
    id:'main_ch3_base',icon:'âš–ï¸',
    title:'Chapitre III â€” L\'Ã‰gale',
    meta:'DÃ©bloquÃ© Ã  500 XP',
    excerpt:'Kira n\'a pas le droit d\'accÃ©der Ã  la Forge Haute. Lyam se retrouve face Ã  un choix entre tradition et justice.',
    badge:'âš–ï¸ L\'Ã‰cu d\'Ã‰gale',
    minXP:500,
    isEvent:true,
    text:[
      `La forge haute se trouvait au sommet de la tour sud, lÃ  oÃ¹ la fumÃ©e rejoignait les nuages bas de fÃ©vrier.`,
      `Lyam y montait chaque jeudi. Ce jeudi-lÃ , dans l'escalier Ã©troit, il croisa Kira. Elle descendait. Lui montait. Elle portait des parchemins de formules d'enchantement avancÃ©es â€” le genre que les Ã©cuyers de troisiÃ¨me annÃ©e effleuraient Ã  peine.`,
      `<em>Â« Tu n'es pas supposÃ©e monter. La Forge Haute est rÃ©servÃ©e aux Ã©cuyers du parcours forge. Â»</em>`,
      `Elle le regarda avec quelque chose de plus calme et de plus lourd que la colÃ¨re. La patience prÃ©cise de quelqu'un qui a dÃ©jÃ  cartographiÃ© tous les murs avant de chercher la porte.`,
      `<em>Â« Je sais. On me l'a dÃ©jÃ  dit. Â»</em>`,
      `Elle continua de descendre. Lui continua de monter. Il ne put pas travailler.`,
      `Il pensa Ã  son <em>"je sais"</em>. Pas rÃ©signation â€” prÃ©cision tranquille. Il redescendit, trouva MaÃ®tre Aldric, et posa la question directement. <em>Â« Cette rÃ¨gle. Elle est Ã©crite oÃ¹ ? Â»</em>`,
      `<em>Â« Nulle part. Â»</em>`,
      `<em>Â« Alors elle peut changer ? Â»</em>`,
      `<em>Â« Tout peut changer, Lyam. La question, c'est qui dÃ©cide de le faire. Â»</em>`,
      `La semaine suivante, Kira monta Ã  la Forge Haute pour la premiÃ¨re fois. Elle ne dit rien Ã  Lyam. Ce n'Ã©tait pas Ã  lui qu'elle devait quelque chose.`,
      `Mais dans la cour, elle lui lanÃ§a ses parchemins de formules. <em>Â« Tu en auras besoin pour la semaine prochaine. Â»</em> â€” <em>Â« J'en suis pas sÃ»r. Â»</em> â€” <em>Â« Moi si. Â»</em>`,
    ],
    endNote:'L\'Ã©galitÃ© ne se dÃ©clare pas. Elle se construit, un acte ordinaire Ã  la fois.'
  },
  {
    id:'main_ch4',icon:'ğŸ¥',
    title:'Chapitre IV â€” Le Secours en Danger',
    meta:'DÃ©bloquÃ© Ã  800 XP',
    excerpt:'Un accident au terrain d\'entraÃ®nement. Lyam seul sait ce qu\'il faut faire â€” parce qu\'il a appris.',
    badge:null,
    minXP:800,
    locked:true,
    comingSoon:true
  },
  {
    id:'main_ch5',icon:'ğŸŒŸ',
    title:'Chapitre V â€” La FraternitÃ© des Ã‰cus',
    meta:'DÃ©bloquÃ© Ã  1200 XP',
    excerpt:'Fin de premiÃ¨re annÃ©e. Le chÃ¢teau n\'a pas changÃ©. C\'est Lyam qui a changÃ©. Une lettre qu\'il n\'envoie pas.',
    badge:'ğŸŒŸ Chevalier Complet',
    minXP:1200,
    locked:true,
    comingSoon:true
  },
];

// â”€â”€ SÃ‰QUENCES SATELLITES (LDVELH) â”€â”€
const SATELLITES=[
  {
    id:'sat_egalite',
    icon:'âš–ï¸',
    title:'L\'Ã‰preuve de la Forge',
    pilier:'Module Ã‰galitÃ©',
    unlock:'EGALITE',
    accent:'#7a3a9a',
    isEvent:true,
    excerpt:'Tu es Lyam. Kira vient d\'Ãªtre refoulÃ©e de la Forge Haute. Tu as assistÃ© Ã  la scÃ¨ne. Que fais-tu maintenant ?',
    badge:'âš–ï¸ L\'Ã‰cu d\'Ã‰gale',
    ldvelhId:'egalite',
  },
  {
    id:'sat_pixhare',
    icon:'ğŸ›¡ï¸',
    title:'La Cour des Ombres',
    pilier:'Pilier Groupe â€” PIXHARe',
    unlock:'PIXHARE',
    accent:'#3a6a9a',
    excerpt:'RÃ©na est de nouveau la cible. Cette fois, c\'est plus subtil. Et cette fois, tu as des outils.',
    badge:'ğŸ›¡ï¸ Gardien du Groupe',
    ldvelhId:'pixhare',
    comingSoon:true,
  },
  {
    id:'sat_psc1',
    icon:'ğŸ¥',
    title:'Le BlessÃ© du Tournoi',
    pilier:'Module PSC1',
    unlock:'PSC1',
    accent:'#9a3a3a',
    excerpt:'Le tournoi de printemps. Un Ã©cuyer tombe. Les adultes sont loin. Tu es le seul Ã  savoir quoi faire.',
    badge:'ğŸ¥ Gardien des Corps',
    ldvelhId:'psc1',
    comingSoon:true,
  },
  {
    id:'sat_fraternite',
    icon:'ğŸ¤',
    title:'Le Banquet des Maisons',
    pilier:'Pilier FraternitÃ©',
    unlock:'FRATERNITE',
    accent:'#3a9a5a',
    excerpt:'Les Maisons Argent et Bois ont Ã©tÃ© convoquÃ©es pour un banquet de rÃ©conciliation. Lyam doit les y aider.',
    badge:'ğŸ¤ Tisserand de Liens',
    ldvelhId:'fraternite',
    comingSoon:true,
  },
  {
    id:'sat_liberte',
    icon:'ğŸ—½',
    title:'La PÃ©tition',
    pilier:'Hub LibertÃ©',
    unlock:'LIBERTE',
    accent:'#9a8a2a',
    excerpt:'Les Ã©cuyers de premiÃ¨re annÃ©e veulent changer une rÃ¨gle du chÃ¢teau. Mais comment faire entendre sa voix ?',
    badge:'ğŸ—½ Voix du Peuple',
    ldvelhId:'liberte',
    comingSoon:true,
  },
  {
    id:'sat_delegues',
    icon:'ğŸ“£',
    title:'Le Conseil des Ã‰cuyers',
    pilier:'Hub DÃ©lÃ©guÃ©s',
    unlock:'DELEGUES',
    accent:'#5a7a3a',
    excerpt:'Lyam est Ã©lu reprÃ©sentant de sa maison. Son premier vrai conseil. Ses camarades comptent sur lui.',
    badge:'ğŸ“£ DÃ©lÃ©guÃ© de Valdurne',
    ldvelhId:'delegues',
    comingSoon:true,
  },
];

function isUnlocked_sat(sat,p){
  if(!p)return false;
  const cp=p.cp||{};
  const logs=p.logs||[];
  if(sat.unlock==='EGALITE')
    return (cp.autres||0)>=1||logs.some(l=>(l.t||'').includes('EGALITE')||(l.act||'').includes('EGALITE'));
  if(sat.unlock==='PIXHARE')return (cp.pixhare||0)>=1;
  if(sat.unlock==='PSC1')return (cp.psc1||0)>=1;
  if(sat.unlock==='FRATERNITE')return logs.some(l=>(l.t||'').includes('FRATERNITE'));
  if(sat.unlock==='LIBERTE')return logs.some(l=>(l.t||'').includes('LIBERTE'));
  if(sat.unlock==='DELEGUES')return logs.some(l=>(l.t||'').includes('DELEGUES'));
  return false;
}

function renderMainStory(p,xp){
  const grid=document.getElementById('mainStoryGrid');
  grid.innerHTML='';
  MAIN_CHAPTERS.forEach(ch=>{
    const unlocked=xp>=ch.minXP;
    const done=isDone(ch.id);
    const card=document.createElement('div');
    card.className='story-card'+(unlocked?' unlocked':'  locked')+(done?' completed':'');
    card.style.setProperty('--card-accent','#c9a84c');

    if(unlocked&&!ch.comingSoon){
      card.onclick=()=>openMainChapter(ch);
      card.innerHTML=`
        ${ch.isEvent?'<div class="event-ribbon">âœ¨ Ã‰VÃ‰NEMENT</div>':''}
        <span class="sc-icon">${ch.icon}</span>
        <div class="sc-title">${ch.title}</div>
        <div class="sc-meta">${ch.meta}</div>
        <div class="sc-excerpt">${ch.excerpt}</div>
        <div class="sc-footer">
          ${ch.badge?`<span class="sc-badge">${ch.badge}</span>`:'<span></span>'}
          <span class="sc-cta">${done?'Relire':'Lire â–¸'}</span>
        </div>`;
    } else if(ch.comingSoon){
      card.innerHTML=`
        <span class="sc-icon">${ch.icon}</span>
        <div class="sc-title">${ch.title}</div>
        <div class="sc-meta">${ch.meta}</div>
        <div class="sc-excerpt">${ch.excerpt}</div>
        <div class="sc-footer"><span class="sc-locked-hint">ğŸ“… Ã€ venirâ€¦</span></div>`;
    } else {
      card.innerHTML=`
        <span class="sc-icon">ğŸ”’</span>
        <div class="sc-title">${ch.title}</div>
        <div class="sc-meta">${ch.meta}</div>
        <div class="sc-locked-hint">Il te faut ${ch.minXP-xp} XP de plus pour dÃ©verrouiller ce chapitre.</div>`;
    }
    grid.appendChild(card);
  });
}

function renderSatellites(p){
  const grid=document.getElementById('satelliteGrid');
  grid.innerHTML='';
  SATELLITES.forEach(sat=>{
    const unlocked=isUnlocked_sat(sat,p);
    const done=isDone(sat.id);
    const card=document.createElement('div');
    card.className='story-card'+(unlocked?' unlocked':'  locked')+(done?' completed':'');
    card.style.setProperty('--card-accent',sat.accent||'#c9a84c');

    if(unlocked&&!sat.comingSoon){
      card.onclick=()=>openLdvelh(sat.ldvelhId,sat);
      card.innerHTML=`
        ${sat.isEvent?'<div class="event-ribbon">ğŸ—“ï¸ Ã‰VÃ‰NEMENT</div>':''}
        <span class="sc-icon">${sat.icon}</span>
        <div class="sc-title">${sat.title}</div>
        <div class="sc-meta">${sat.pilier}</div>
        <div class="sc-excerpt">${sat.excerpt}</div>
        <div class="sc-footer">
          ${sat.badge?`<span class="sc-badge">${sat.badge}</span>`:'<span></span>'}
          <span class="sc-cta">${done?'Rejouer':'â–¸ Incarner le hÃ©ros'}</span>
        </div>`;
    } else if(sat.comingSoon&&unlocked){
      card.innerHTML=`
        <span class="sc-icon">${sat.icon}</span>
        <div class="sc-title">${sat.title}</div>
        <div class="sc-meta">${sat.pilier}</div>
        <div class="sc-excerpt">${sat.excerpt}</div>
        <div class="sc-footer"><span class="sc-locked-hint">ğŸ“… SÃ©quence en cours de rÃ©dactionâ€¦</span></div>`;
    } else {
      card.innerHTML=`
        <span class="sc-icon">ğŸ”’</span>
        <div class="sc-title">${sat.title}</div>
        <div class="sc-meta">${sat.pilier}</div>
        <div class="sc-locked-hint">ComplÃ¨te <strong>${sat.pilier}</strong> dans le Portail Vie Scolaire pour dÃ©bloquer cette sÃ©quence.</div>`;
    }
    grid.appendChild(card);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LECTURE CHAPITRE PRINCIPAL (texte simple)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openMainChapter(ch){
  const modal=document.getElementById('ldvelhModal');
  const content=document.getElementById('ldvelhContent');
  const title=document.getElementById('ldvelhTitle');
  const prog=document.getElementById('ldvelhProgress');

  title.textContent=ch.title;
  prog.innerHTML='';

  const html=`
    <div class="passage active">
      <div class="passage-num">ğŸ“š Histoire Principale Â· Saison I</div>
      <div class="passage-mood">${ch.icon}</div>
      <div class="passage-text">
        ${(ch.text||[]).map(t=>`<p>${t}</p>`).join('')}
      </div>
      <hr class="passage-divider">
      <div style="font-style:italic;color:var(--encre-2);font-size:0.85em;opacity:0.75;text-align:center;margin-bottom:20px">${ch.endNote||''}</div>
      ${ch.badge?`<div style="text-align:center;margin-bottom:16px"><span class="sc-badge" style="font-size:0.9em">${ch.badge}</span></div>`:''}
      <div style="text-align:center">
        <button class="btn-retry" onclick="closeLdvelh()">Fermer</button>
      </div>
    </div>`;
  content.innerHTML=html;
  modal.classList.add('open');
  markDone(ch.id);
  updateCounter();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOTEUR LDVELH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function closeLdvelh(){
  document.getElementById('ldvelhModal').classList.remove('open');
}

function updateCounter(){
  const d=getDone();
  document.getElementById('chaptersRead').textContent=Object.values(d).filter(v=>v).length;
}

// â”€â”€ DÃ©finitions des sÃ©quences LDVELH â”€â”€
const SEQUENCES={
  egalite:{
    title:'L\'Ã‰preuve de la Forge â€” SÃ©quence Ã‰galitÃ©',
    steps:6,
    start:'p1',
    passages:{
      p1:{
        num:'Â§ 1 Â· La rencontre',
        mood:'âš–ï¸',
        text:[
          `Tu es Lyam. Apprenti Ã©cuyer de premiÃ¨re annÃ©e.`,
          `Ce matin, en traversant le couloir de la tour sud pour rejoindre ton cours de stratÃ©gie, tu assistes Ã  quelque chose.`,
          `La ChancelliÃ¨re Maren barre le chemin Ã  Kira â€” l'Ã©cuyÃ¨re que tout le monde sait Ãªtre la meilleure en formules d'enchantement â€” et lui dit froidement : <em>Â« La Forge Haute est rÃ©servÃ©e aux parcours forge. Ce n'est pas ton chemin. Â»</em>`,
          `Kira ne discute pas. Elle hoche la tÃªte et repart. Mais tu as vu son visage une fraction de seconde avant â€” la faÃ§on dont elle a rangÃ© quelque chose trÃ¨s loin Ã  l'intÃ©rieur d'elle-mÃªme.`,
          `La ChancelliÃ¨re s'en va. Tu es seul dans le couloir avec Kira.`,
        ],
        choices:[
          {text:'Aller voir Kira et lui demander si elle va bien.',next:'p2a'},
          {text:'Continuer vers ton cours. Ce n\'est pas ton problÃ¨me.',next:'p2b'},
          {text:'Regarder discrÃ¨tement, sans intervenir.',next:'p2c'},
        ]
      },
      p2a:{
        num:'Â§ 2 Â· Le contact',
        mood:'ğŸ¤',
        text:[
          `Tu t'approches de Kira. Elle te regarde avec un calme que tu trouves difficile Ã  dÃ©chiffrer.`,
          `<em>Â« Je t'ai vu, Â»</em> dit-elle simplement. <em>Â« Tu n'avais pas Ã  t'arrÃªter. Â»</em>`,
          `<em>Â« Je sais. Â»</em>`,
          `Un silence. Puis elle te montre ses parchemins â€” des formules de niveau trois. Tu ne comprends pas la moitiÃ© des symboles.`,
          `<em>Â« C'est injuste, Â»</em> dis-tu. Ce n'est pas malin comme rÃ©ponse, mais c'est vrai.`,
          `<em>Â« Oui. Â»</em> Elle range ses parchemins. <em>Â« La question c'est ce qu'on fait avec une injustice qu'on a identifiÃ©e. Â»</em>`,
          `Tu sais que MaÃ®tre Aldric gÃ¨re les accÃ¨s Ã  la Forge Haute. Tu pourrais lui parler. Mais tu ne sais pas encore si tu veux te mÃªler de Ã§a.`,
        ],
        choices:[
          {text:'Proposer Ã  Kira d\'aller voir Aldric avec elle.',next:'p3a'},
          {text:'Lui dire que tu poseras la question Ã  Aldric toi-mÃªme.',next:'p3b'},
          {text:'Lui suggÃ©rer de demander audience au Doyen directement.',next:'p3c'},
        ]
      },
      p2b:{
        num:'Â§ 2 Â· L\'absence',
        mood:'ğŸ˜¶',
        text:[
          `Tu continues vers ton cours. Le couloir se vide. Le cours commence.`,
          `Pendant toute la leÃ§on, tu n'arrÃªtes pas de penser Ã  la faÃ§on dont Kira a rangÃ© quelque chose trÃ¨s loin en elle-mÃªme avant de repartir.`,
          `Ã€ la pause, tu interroges RÃ©na sur Kira. Il lÃ¨ve les yeux de son parchemin : <em>Â« Kira ? La ChancelliÃ¨re lui interdit la Forge Haute depuis le dÃ©but de l'annÃ©e. C'est une vieille rÃ¨gle. Pas Ã©crite, mais bien rÃ©elle. Â»</em>`,
          `<em>Â« Et personne n'a rien dit ? Â»</em>`,
          `RÃ©na te regarde. <em>Â« Toi non plus tu n'as rien dit, apparemment. Â»</em>`,
          `Ce n'est pas une accusation. C'est juste la rÃ©alitÃ©. Tu as encore le temps d'agir.`,
        ],
        choices:[
          {text:'Aller trouver Kira maintenant, entre deux cours.',next:'p3b'},
          {text:'Parler Ã  MaÃ®tre Aldric directement, sans impliquer Kira.',next:'p3b'},
          {text:'Rester en dehors. Ce n\'est vraiment pas ton rÃ´le.',next:'p_mauvais_chemin'},
        ]
      },
      p2c:{
        num:'Â§ 2 Â· L\'observateur',
        mood:'ğŸ‘ï¸',
        text:[
          `Tu restes en retrait. Tu observes.`,
          `Kira repart sans se retourner. La ChancelliÃ¨re disparaÃ®t dans une salle latÃ©rale. Le couloir est vide.`,
          `Tu as vu quelque chose. Tu ne sais pas encore quoi en faire. Mais tu n'as pas regardÃ© ailleurs non plus â€” tu as choisi de <em>voir</em>. C'est un dÃ©but.`,
          `Dans l'aprÃ¨s-midi, tu apprends par RÃ©na que cette situation dure depuis le dÃ©but de l'annÃ©e. Kira ne peut pas accÃ©der aux Ã©quipements les plus avancÃ©s simplement parce qu'une vieille rÃ¨gle non Ã©crite dit que "ce n'est pas son chemin".`,
          `Tu as plusieurs options.`,
        ],
        choices:[
          {text:'Aller parler Ã  Kira maintenant.',next:'p2a'},
          {text:'Aller voir MaÃ®tre Aldric directement.',next:'p3b'},
          {text:'Laisser faire. Tu as vu, mais c\'est suffisant.',next:'p_mauvais_chemin'},
        ]
      },
      p3a:{
        num:'Â§ 3 Â· Le MaÃ®tre',
        mood:'ğŸ”¥',
        text:[
          `Vous trouvez Aldric Ã  la Forge du bas, soufflant des braises sur une lame en cours.`,
          `Kira explique. Aldric Ã©coute sans l'interrompre â€” ce qui, tu l'apprendras, est une forme de respect qu'il rÃ©serve Ã  peu de gens.`,
          `<em>Â« C'est une vieille rÃ¨gle, Â»</em> dit-il quand elle a fini. <em>Â« Jamais Ã©crite nulle part. Â»</em>`,
          `<em>Â« Donc elle peut changer ? Â»</em> demandes-tu.`,
          `<em>Â« Tout peut changer. La question c'est qui dÃ©cide de le faire, et comment. Â»</em>`,
          `Il vous regarde tous les deux. <em>Â« Si vous voulez porter Ã§a formellement, il vous faut une demande Ã©crite. Je la transmettrai au Doyen. Ã‡a ne prend pas cinq minutes â€” Ã§a prend du courage. Â»</em>`,
          `Kira prend un parchemin dans sa besace. Elle commence Ã  Ã©crire.`,
        ],
        choices:[
          {text:'L\'aider Ã  rÃ©diger la demande, en cosignant avec elle.',next:'p4'},
          {text:'La laisser Ã©crire seule â€” c\'est son combat, pas le tien.',next:'p4_seul'},
        ]
      },
      p3b:{
        num:'Â§ 3 Â· La dÃ©marche solitaire',
        mood:'ğŸ•¯ï¸',
        text:[
          `Tu trouves MaÃ®tre Aldric le lendemain matin, avant que le feu soit allumÃ©.`,
          `Tu n'as pas prÃ©parÃ© de discours. Tu lui dis juste ce que tu as vu, et ce que tu ne comprends pas.`,
          `<em>Â« C'est une vieille rÃ¨gle. Elle n'a jamais Ã©tÃ© Ã©crite nulle part. Â»</em>`,
          `<em>Â« Alors elle peut changer ? Â»</em>`,
          `<em>Â« Tout peut changer, Lyam. La question, c'est qui dÃ©cide de le faire. Â»</em>`,
          `Il marque une pause. Les braises prennent.`,
          `<em>Â« Si tu veux porter Ã§a, il faut une demande formelle. Je la ferai remonter. Mais elle doit venir de Kira â€” ou avec son accord. Â»</em>`,
          `Tu vas trouver Kira et tu lui expliques ce que tu as fait. Elle te regarde longtemps, puis dit : <em>Â« Bien. Je cosigne. Â»</em>`,
        ],
        choices:[
          {text:'RÃ©diger la demande ensemble et la remettre Ã  Aldric.',next:'p4'},
        ]
      },
      p3c:{
        num:'Â§ 3 Â· Le Doyen',
        mood:'ğŸ›ï¸',
        text:[
          `Tu proposes Ã  Kira d\'aller directement au Doyen Ferraud.`,
          `Elle hÃ©site. <em>Â« C'est risquÃ©. Ferraud n'aime pas qu'on contourne la hiÃ©rarchie. Â»</em>`,
          `<em>Â« On ne contourne rien. On va lÃ  oÃ¹ les dÃ©cisions se prennent. Â»</em>`,
          `Ferraud vous reÃ§oit le lendemain. Il Ã©coute Kira, puis te regarde. <em>Â« Et toi, tu es lÃ  pourquoi ? Â»</em>`,
          `<em>Â« Parce que j'ai vu quelque chose d'injuste et que je ne pouvais pas juste passer mon chemin. Â»</em>`,
          `Un long silence. Ferraud griffonne quelque chose.`,
          `<em>Â« Je vais examiner le Codex. Revenez dans trois jours. Â»</em>`,
          `Trois jours plus tard : la rÃ¨gle est abolie. Pas d'annonce. Juste un texte affichÃ© sur le panneau des maisons. Kira te montre son parchemin de formules en passant. <em>Â« Tu en auras besoin. Â»</em>`,
        ],
        choices:[
          {text:'Passer au moment du choix final.',next:'p4_rapide'},
        ]
      },
      p_mauvais_chemin:{
        num:'Â§ Une voie sans issue',
        mood:'ğŸŒ«ï¸',
        text:[
          `Tu passes ton chemin. Le couloir se vide. La vie continue.`,
          `Pendant des jours, tu continues de croiser Kira dans les couloirs de Valdurne. Elle ne te regarde pas diffÃ©remment â€” elle ne sait pas que tu as vu. Mais toi, tu sais.`,
          `RÃ©na te demande un soir : <em>Â« Tu savais que Kira ne peut toujours pas accÃ©der Ã  la Forge Haute ? Â»</em>`,
          `Tu rÃ©ponds que oui.`,
          `<em>Â« Et tu n'as rien fait ? Â»</em>`,
          `Il n'y a pas de jugement dans sa voix. Juste la question, posÃ©e comme un fait.`,
          `Cette fois, c'est diffÃ©rent. Tu as le choix de retourner en arriÃ¨re.`,
        ],
        choices:[
          {text:'Retourner au dÃ©but et faire autrement.',next:'p1'},
          {text:'Fermer cette sÃ©quence.',action:'close'},
        ]
      },
      p4:{
        num:'Â§ 4 Â· La rÃ©ponse de Valdurne',
        mood:'âœ¨',
        text:[
          `Trois jours aprÃ¨s la demande, un texte apparaÃ®t sur le panneau des maisons.`,
          `Pas d'annonce officielle. Pas de cÃ©rÃ©monie. Juste quelques lignes : la rÃ¨gle d'accÃ¨s Ã  la Forge Haute est rÃ©visÃ©e â€” l'accÃ¨s est dÃ©sormais fondÃ© sur les compÃ©tences documentÃ©es, pas sur le parcours assignÃ©.`,
          `La semaine suivante, Kira monte Ã  la Forge pour la premiÃ¨re fois. Trois heures de travail ininterrompu. Aldric ne lui dit rien de particulier â€” il lui montre oÃ¹ sont les outils, comme Ã  n'importe quel autre Ã©cuyer.`,
          `C'est suffisant.`,
          `En passant dans la cour, elle te lance ses parchemins de formules. <em>Â« Tu en auras besoin. Â»</em> â€” <em>Â« J'en suis pas sÃ»r. Â»</em> â€” <em>Â« Moi si. Â»</em>`,
          `Et maintenant â€” le vrai moment de cette histoire.`,
          `Ton ami Tolven t'accoste le soir mÃªme. Il est agitÃ©.`,
        ],
        choices:[
          {text:'Ã‰couter ce que Tolven a Ã  dire.',next:'p5_dilemme'},
        ]
      },
      p4_seul:{
        num:'Â§ 4 Â· La dÃ©cision de Kira',
        mood:'âœï¸',
        text:[
          `Kira rÃ©dige seule. Tu assistes, un peu en retrait.`,
          `La demande arrive sur le bureau du Doyen. Trois jours plus tard, un texte apparaÃ®t sur le panneau : la rÃ¨gle est rÃ©visÃ©e.`,
          `En passant dans la cour, Kira te lance ses parchemins. <em>Â« Tu en auras besoin. Â»</em>`,
          `Et Tolven s'approche.`,
        ],
        choices:[
          {text:'Voir ce que Tolven veut dire.',next:'p5_dilemme'},
        ]
      },
      p4_rapide:{
        num:'Â§ 4 Â· Ce soir-lÃ ',
        mood:'ğŸŒ™',
        text:[
          `Ce soir-lÃ , Tolven t'accoste.`,
        ],
        choices:[
          {text:'Ã‰couter.',next:'p5_dilemme'},
        ]
      },
      p5_dilemme:{
        num:'Â§ 5 Â· Le vrai choix',
        mood:'âš–ï¸',
        text:[
          `<em>Â« C'est injuste. Â»</em>`,
          `Tolven est furieux, mais il parle bas. <em>Â« Moi, j'ai attendu deux ans pour accÃ©der Ã  la Forge Haute. Deux ans Ã  faire mes preuves dans le parcours standard. Elle, Ã§a lui prend une pÃ©tition et une semaine. T'aurais dÃ» te taire, Lyam. Â»</em>`,
          `Il ne t'accuse pas vraiment. Il exprime quelque chose qu'il ressent comme une injustice. Et c'est lÃ  que tu dois rÃ©pondre.`,
          `Comment lui expliques-tu que corriger une injustice, ce n'est pas en crÃ©er une nouvelle ?`,
        ],
        choices:[
          {text:'"T\'as raison, j\'aurais peut-Ãªtre pas dÃ» m\'impliquer. C\'est compliquÃ©."',next:'p_echec',result:'fail'},
          {text:'"Kira attendait aussi. Juste d\'une rÃ¨gle injuste qu\'on lÃ¨ve enfin. Ta patience valait quelque chose â€” sa compÃ©tence aussi."',next:'p_succes',result:'success'},
          {text:'"Je comprends que tu te sentes lÃ©sÃ©. Mais ce qu\'on a corrigÃ©, c\'est une rÃ¨gle qui l\'empÃªchait d\'accÃ©der Ã  quelque chose qu\'elle mÃ©ritait. Ã‡a ne t\'enlÃ¨ve rien."',next:'p_succes',result:'success'},
        ]
      },
      p_succes:{
        num:'Â§ Fin â€” La vÃ©ritÃ© de Tolven',
        mood:'ğŸŒŸ',
        isResult:true,
        resultType:'success',
        text:[
          `Tolven reste silencieux un long moment.`,
          `Puis : <em>Â« Elle mÃ©ritait vraiment ? Â»</em>`,
          `<em>Â« Tu l'as vue travailler. Â»</em>`,
          `<em>Â« ...Oui. Â»</em>`,
          `Il repart sans rien ajouter. Ce n'est pas une victoire. Juste une graine plantÃ©e. Peut-Ãªtre qu'elle poussera, peut-Ãªtre pas.`,
          `Mais tu as dit ce qui Ã©tait juste. Pas parce que c'Ã©tait facile â€” parce que c'Ã©tait vrai.`,
        ],
        endNote:`L'Ã©galitÃ© n'est pas un jeu Ã  somme nulle. Corriger une injustice n'en crÃ©e pas une nouvelle â€” elle rend le terrain plus juste pour tout le monde. Tu l'as compris.`
      },
      p_echec:{
        num:'Â§ Un doute',
        mood:'ğŸŒ«ï¸',
        isResult:true,
        resultType:'fail',
        text:[
          `Tolven hoche la tÃªte. <em>Â« VoilÃ . C'est ce que je pensais. Â»</em>`,
          `Il repart satisfait. Mais toi, quelque chose te reste dans l'estomac.`,
          `Tu viens de valider l'idÃ©e que corriger une injustice ancienne crÃ©e une injustice nouvelle. Mais ce n'est pas vrai. Kira attendait aussi â€” pas de l'entrainement, mais d'une rÃ¨gle injuste qu'on lÃ¨ve enfin.`,
          `Ce n'est pas grave. Les bonnes rÃ©ponses s'apprennent, souvent aprÃ¨s les fausses. Tu peux recommencer.`,
        ],
        endNote:`L'Ã©galitÃ© n'enlÃ¨ve rien Ã  ceux qui ont attendu honnÃªtement. Elle donne accÃ¨s Ã  ceux qui en ont Ã©tÃ© privÃ©s injustement. Relis le chapitre et retente le choix final.`
      },
    }
  }
};

// â”€â”€ Gestion de la progression dans le LDVELH â”€â”€
let currentSeq=null, currentSat=null, stepHistory=[];

function openLdvelh(seqId,sat){
  const seq=SEQUENCES[seqId];
  if(!seq)return;
  currentSeq=seq;
  currentSat=sat;
  stepHistory=[];

  const modal=document.getElementById('ldvelhModal');
  document.getElementById('ldvelhTitle').textContent=seq.title;
  modal.classList.add('open');
  renderPassage(seq.start);
}

function renderPassage(passageId){
  const seq=currentSeq;
  const pass=seq.passages[passageId];
  if(!pass)return;
  stepHistory.push(passageId);

  // Barre de progression
  const prog=document.getElementById('ldvelhProgress');
  prog.innerHTML='';
  for(let i=0;i<seq.steps;i++){
    const s=document.createElement('div');
    s.className='prog-step'+(i<stepHistory.length-1?' done':i===stepHistory.length-1?' current':'');
    prog.appendChild(s);
  }

  const content=document.getElementById('ldvelhContent');
  let html=`<div class="passage active">`;
  html+=`<div class="passage-num">${pass.num}</div>`;
  if(pass.mood) html+=`<div class="passage-mood">${pass.mood}</div>`;
  html+=`<div class="passage-text">${(pass.text||[]).map(t=>`<p>${t}</p>`).join('')}</div>`;
  html+=`<hr class="passage-divider">`;

  if(pass.isResult){
    const ok=pass.resultType==='success';
    const xp=ok?XP_BON_CHOIX:XP_MAUVAIS_CHOIX;
    if(ok){markDone(currentSat?.id||'ldvelh')}

    html+=`<div class="result-block ${ok?'success':'failure'}">
      <span class="result-icon">${ok?'â­':'ğŸ’­'}</span>
      <div class="result-title">${ok?'RÃ©ponse juste !':'Ã€ retravaillerâ€¦'}</div>
      <div class="result-xp">${ok?'+'+xp+' XP':''+xp+' XP'}</div>
      <div class="result-text">${pass.endNote||''}</div>
      <div style="margin-top:12px">
        ${!ok?`<button class="btn-retry" onclick="openLdvelh('${currentSeq?.passages?'egalite':'egalite'}',currentSat)">Recommencer</button>`:''}
        <button class="btn-close-result" onclick="closeLdvelh()">Fermer</button>
      </div>
    </div>`;

    // CrÃ©diter le XP
    creditXP(currentCode, xp, ok?'NARRATION_EGALITE_SUCCESS':'NARRATION_EGALITE_ECHEC');
    showXpNotif(xp);
    updateCounter();

  } else if(pass.choices){
    html+=`<div class="choices">`;
    pass.choices.forEach(c=>{
      if(c.action==='close'){
        html+=`<button class="choice-btn" onclick="closeLdvelh()">${c.text}</button>`;
      } else {
        html+=`<button class="choice-btn" onclick="renderPassage('${c.next}')">${c.text}</button>`;
      }
    });
    html+=`</div>`;
  }
  html+=`</div>`;
  content.innerHTML=html;
  document.getElementById('ldvelhModal').scrollTop=0;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATION XP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showXpNotif(amount){
  const div=document.createElement('div');
  div.className='xp-notif '+(amount>0?'success':'fail');
  div.textContent=amount>0?`+${amount} XP â€” Bien jouÃ© !`:`${amount} XP â€” Retente le choix final.`;
  document.body.appendChild(div);
  setTimeout(()=>div.remove(),5000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLAVIER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('codeInput').addEventListener('keydown',e=>{
  if(e.key==='Enter')tryLogin();
});
document.addEventListener('keydown',e=>{
  if(e.key==='Escape')closeLdvelh();
});
</script>
</body>
</html>
