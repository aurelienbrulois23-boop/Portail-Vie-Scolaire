<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIX-pHARe | Le Spectre NumÃ©rique</title>
    <style>
        :root {
            --primary: #00d4ff;
            --accent: #ff006e;
            --success: #00ff88;
            --warning: #ffbe0b;
            --dark: #0a0a1a;
            --darker: #050510;
            --card: #12122a;
            --light: #e8e8e8;
            --gold: #ffd700;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #1a0a2e 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .app-container {
            width: 100%;
            max-width: 900px;
            background: var(--card);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,212,255,0.2), 0 0 0 1px rgba(0,212,255,0.1);
            padding: 40px;
            position: relative;
            overflow: hidden;
        }
        .app-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, #00d4ff, #ff006e, #00ff88);
        }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 {
            font-size: 2.2em;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 5px;
            text-shadow: 0 0 20px rgba(0,212,255,0.5);
        }
        .header .subtitle { color: var(--accent); font-size: 1.1em; }
        .header .level-badge {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: #000;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
            display: inline-block;
            margin-top: 10px;
        }
        .progress-container { background: var(--darker); border-radius: 10px; padding: 15px 20px; margin-bottom: 25px; }
        .progress-bar-outer { background: rgba(255,255,255,0.1); border-radius: 10px; height: 12px; overflow: hidden; margin-top: 10px; }
        .progress-bar-inner { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); border-radius: 10px; transition: width 0.5s ease; }
        .progress-stats { display: flex; justify-content: space-between; font-size: 0.9em; }
        .xp-badge { background: var(--gold); color: #000; padding: 3px 12px; border-radius: 15px; font-weight: bold; }
        .btn {
            background: linear-gradient(135deg, var(--primary), #0099cc);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,212,255,0.4); }
        .btn-secondary { background: linear-gradient(135deg, #444, #333); color: #fff; }
        .btn-success { background: linear-gradient(135deg, var(--success), #00cc6a); color: #000; }
        .btn-warning { background: linear-gradient(135deg, var(--warning), #cc9900); color: #000; }
        .btn-danger { background: linear-gradient(135deg, var(--accent), #cc0055); color: #fff; }
        .btn-block { width: 100%; justify-content: center; }
        .btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        .card { background: linear-gradient(145deg, #1a1a3a, #12122a); color: var(--light); padding: 30px; border-radius: 15px; margin: 20px 0; border: 1px solid rgba(0,212,255,0.2); }
        .flashcard-container { perspective: 1000px; margin: 25px 0; }
        .flashcard {
            background: linear-gradient(145deg, #1a1a3a, #0a0a1a);
            color: var(--light);
            padding: 40px 30px;
            border-radius: 15px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.6s, box-shadow 0.3s;
            transform-style: preserve-3d;
            box-shadow: 0 15px 40px rgba(0,212,255,0.2);
            position: relative;
            border: 1px solid rgba(0,212,255,0.3);
        }
        .flashcard:hover { box-shadow: 0 20px 50px rgba(0,212,255,0.4); }
        .flashcard.flipped { transform: rotateY(180deg); }
        .flashcard .front, .flashcard .back { backface-visibility: hidden; position: absolute; width: calc(100% - 60px); }
        .flashcard .back { transform: rotateY(180deg); }
        .flashcard .question { font-size: 1.3em; font-weight: 600; line-height: 1.5; }
        .flashcard .answer { font-size: 1.1em; line-height: 1.6; }
        .flashcard .answer-label { color: var(--primary); font-weight: bold; font-size: 0.9em; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 2px; }
        .flashcard .source { margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 0.85em; color: #888; font-style: italic; }
        .flashcard .tap-hint { position: absolute; bottom: 15px; font-size: 0.8em; color: #666; }
        .card-counter { text-align: center; margin-bottom: 15px; font-size: 0.95em; opacity: 0.8; }
        .quiz-question { background: var(--darker); padding: 25px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid var(--accent); }
        .quiz-question .label { color: var(--accent); font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .quiz-choices { display: flex; flex-direction: column; gap: 12px; }
        .quiz-choice {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            color: var(--light);
            padding: 18px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 1rem;
        }
        .quiz-choice:hover { background: rgba(0,212,255,0.15); border-color: var(--primary); transform: translateX(5px); }
        .quiz-choice.correct { background: rgba(0,255,136,0.2); border-color: var(--success); }
        .quiz-choice.incorrect { background: rgba(255,0,110,0.2); border-color: var(--accent); }
        .quiz-choice.disabled { pointer-events: none; opacity: 0.6; }
        .feedback { padding: 20px; border-radius: 12px; margin-top: 20px; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .feedback.correct { background: rgba(0,255,136,0.15); border: 1px solid var(--success); }
        .feedback.incorrect { background: rgba(255,0,110,0.15); border: 1px solid var(--accent); }
        .feedback .title { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; }
        .feedback.correct .title { color: var(--success); }
        .feedback.incorrect .title { color: var(--accent); }
        .dojo-scenario { background: linear-gradient(135deg, var(--darker), #1a0a2e); padding: 25px; border-radius: 12px; border: 1px solid rgba(255,0,110,0.3); margin-bottom: 20px; }
        .dojo-scenario .context-label { color: var(--accent); font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .dojo-scenario .context { font-size: 1.05em; line-height: 1.7; margin-bottom: 20px; }
        .dojo-scenario .question { background: rgba(255,190,11,0.1); padding: 15px; border-radius: 8px; border-left: 3px solid var(--warning); }
        .impact-badge { display: inline-block; padding: 3px 10px; border-radius: 15px; font-size: 0.8em; font-weight: bold; margin-left: 10px; }
        .impact-positive { background: var(--success); color: #000; }
        .impact-negative { background: var(--accent); color: #fff; }
        .impact-neutral { background: var(--warning); color: #000; }
        .save-code-section { background: #050510; border: 2px dashed var(--primary); border-radius: 12px; padding: 25px; margin: 25px 0; }
        .save-code-box { background: #000; color: var(--primary); font-family: 'Courier New', monospace; padding: 20px; border-radius: 8px; word-break: break-all; font-size: 0.85em; line-height: 1.5; user-select: all; margin: 15px 0; max-height: 120px; overflow-y: auto; }
        .save-instructions { background: rgba(0,212,255,0.1); border: 1px solid var(--primary); padding: 15px; border-radius: 8px; margin-top: 20px; }
        .save-instructions h4 { color: var(--primary); margin-bottom: 10px; }
        .save-instructions ul { margin-left: 20px; line-height: 1.8; }
        .report { background: linear-gradient(145deg, #1a1a3a, #0a0a1a); border-radius: 15px; overflow: hidden; border: 1px solid rgba(0,212,255,0.3); }
        .report-header { background: linear-gradient(135deg, var(--primary), #0099cc); color: #000; padding: 30px; text-align: center; }
        .report-header h2 { font-size: 1.8em; margin-bottom: 5px; }
        .report-body { padding: 30px; }
        .report-stat { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .report-stat:last-child { border-bottom: none; }
        .report-stat .label { color: #888; }
        .report-stat .value { font-weight: bold; }
        .mastery-badge { display: inline-block; padding: 8px 20px; border-radius: 25px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .mastery-expert { background: linear-gradient(135deg, var(--gold), #cc9900); color: #000; }
        .mastery-confirmed { background: linear-gradient(135deg, var(--primary), #0099cc); color: #000; }
        .mastery-learning { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: #fff; }
        .unlock-section { background: linear-gradient(135deg, #1a0a2e, #0a0a1a); border: 2px solid var(--warning); border-radius: 15px; padding: 30px; text-align: center; margin: 20px 0; }
        .unlock-section h3 { color: var(--warning); margin-bottom: 15px; }
        .unlock-section input { width: 100%; padding: 15px; border: 2px solid #333; border-radius: 8px; background: #050510; color: var(--primary); font-family: 'Courier New', monospace; font-size: 0.9em; margin: 15px 0; }
        .unlock-section input:focus { outline: none; border-color: var(--primary); }
        .error-msg { color: var(--accent); font-weight: bold; margin-top: 10px; }
        .level-indicator { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; }
        .level-dot { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2em; background: var(--darker); border: 3px solid #333; transition: all 0.3s; }
        .level-dot.active { border-color: var(--primary); box-shadow: 0 0 20px rgba(0,212,255,0.5); }
        .level-dot.completed { background: var(--success); border-color: var(--success); color: #000; }
        @media (max-width: 600px) { body { padding: 10px; } .app-container { padding: 20px; } .header h1 { font-size: 1.6em; } .flashcard { padding: 25px 20px; min-height: 250px; } .btn { padding: 12px 20px; font-size: 0.9rem; } }
    </style>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script>
        const MODULE_DATA = {
            id: "JURIDIQUE_03",
            version: "1.0.0",
            titre: "LE SPECTRE NUMÃ‰RIQUE",
            sous_titre: "Pilier 3 : CyberharcÃ¨lement",
            description: "MaÃ®triser les spÃ©cificitÃ©s du harcÃ¨lement en ligne : preuves, infractions, et stratÃ©gies de dÃ©fense numÃ©rique.",
            auteur: "Programme pHARe",
            prerequis: "JURIDIQUE_02",
            niveau_difficulte: 3,
            
            niveau1: {
                titre: "Le Terrain NumÃ©rique",
                type: "flashcards",
                xp_reward: 100,
                cartes: [
                    {
                        recto: "Quelle est la SPÃ‰CIFICITÃ‰ majeure du cyberharcÃ¨lement par rapport au harcÃ¨lement \"classique\" ?",
                        verso: "3 diffÃ©rences cruciales :\n\n1. ASYNCHRONE : L'attaque continue mÃªme quand l'agresseur dort\n\n2. INVISIBLE : Pas de feedback visuel de la souffrance (Ã©cran = mur)\n\n3. PERMANENT : Les traces restent (screenshots, archives)",
                        source: "Recherches sur le cyberharcÃ¨lement"
                    },
                    {
                        recto: "Quel est le MEILLEUR PRÃ‰DICTEUR du cyberharcÃ¨lement ?",
                        verso: "Le harcÃ¨lement \"hors ligne\" (traditionnel).\n\nLes Ã©tudes montrent que ceux qui harcÃ¨lent en ligne harcÃ¨lent gÃ©nÃ©ralement aussi en prÃ©sentiel.\n\nLe cyber n'est pas un monde Ã  part : c'est une EXTENSION du rÃ©el.",
                        source: "MÃ©ta-analyses cyberharcÃ¨lement"
                    },
                    {
                        recto: "Qu'est-ce que le RAID NUMÃ‰RIQUE (ou effet de meute en ligne) ?",
                        verso: "Attaque coordonnÃ©e oÃ¹ de nombreuses personnes ciblent la mÃªme victime simultanÃ©ment.\n\nSur internet, l'anonymat + les algorithmes AMPLIFIENT la polarisation de groupe.\n\nChaque participant peut minimiser son rÃ´le : \"J'ai juste envoyÃ© UN message.\"",
                        source: "Loi 2022 - Effet de meute"
                    },
                    {
                        recto: "Quelles INFRACTIONS NUMÃ‰RIQUES spÃ©cifiques peut-on signaler immÃ©diatement ?",
                        verso: "â€¢ USURPATION D'IDENTITÃ‰ (Art. 226-4-1) : Faux compte = 1 an + 15 000â‚¬\n\nâ€¢ REVENGE PORN (Art. 226-2-1) : Diffusion d'images intimes = 2 ans + 60 000â‚¬\n\nâ€¢ HAPPY SLAPPING : Filmer + diffuser une agression = circonstance aggravante\n\nâ€¢ DROIT Ã€ L'IMAGE : Publier sans consentement",
                        source: "Code PÃ©nal"
                    },
                    {
                        recto: "Pourquoi le dÃ©sengagement moral est-il AMPLIFIÃ‰ en ligne ?",
                        verso: "L'Ã©cran crÃ©e une DISTANCE Ã‰MOTIONNELLE :\n\nâ€¢ Pas de larmes visibles\nâ€¢ Pas de voix tremblante\nâ€¢ Pas de langage corporel\n\nâ†’ Le cerveau ne \"connecte\" pas Ã  la souffrance de l'autre\nâ†’ La DISTORSION DES CONSÃ‰QUENCES est automatique",
                        source: "Psychologie du cyberharcÃ¨lement"
                    },
                    {
                        recto: "Comment SÃ‰CURISER des preuves numÃ©riques ?",
                        verso: "La RÃˆGLE D'OR : Screenshot AVANT signalement\n\n1. Capture d'Ã©cran avec DATE/HEURE visible\n2. URL complÃ¨te si possible\n3. Profil de l'auteur (avant qu'il ne le supprime)\n4. Contexte (conversation complÃ¨te)\n\nNe JAMAIS supprimer ou rÃ©pondre d'abord !",
                        source: "Protocole pHARe numÃ©rique"
                    }
                ]
            },
            
            niveau2: {
                titre: "Forensique NumÃ©rique",
                type: "quiz",
                xp_reward: 150,
                questions: [
                    {
                        texte: "Une Ã©lÃ¨ve te montre des messages Instagram humiliants reÃ§us d'un compte anonyme. Elle veut supprimer la conversation pour \"ne plus y penser\".",
                        question: "Que lui conseilles-tu ?",
                        choix: [
                            { txt: "Oui, supprime tout, Ã§a te fera du bien", correct: false, feedback: "ERREUR CRITIQUE ! En supprimant, elle dÃ©truit les PREUVES. Sans preuves, impossible de poursuivre ou de faire agir l'Ã©tablissement." },
                            { txt: "Non ! Screenshot TOUT d'abord, puis on avise", correct: true, feedback: "PARFAIT ! La rÃ¨gle d'or : capturer AVANT toute action. Date, heure, profil, messages, URL. Ces preuves sont essentielles pour le signalement." },
                            { txt: "Bloque juste le compte, c'est suffisant", correct: false, feedback: "Insuffisant ! Bloquer stoppe les messages mais ne constitue pas une preuve. L'auteur peut aussi crÃ©er un nouveau compte. Il faut capturer ET signaler." }
                        ]
                    },
                    {
                        texte: "Un groupe Snapchat a Ã©tÃ© crÃ©Ã© spÃ©cifiquement pour partager des \"memes\" moqueurs sur un Ã©lÃ¨ve. Les messages s'auto-dÃ©truisent.",
                        question: "Quel est le principal dÃ©fi juridique ?",
                        choix: [
                            { txt: "Snapchat est basÃ© aux USA donc la loi franÃ§aise ne s'applique pas", correct: false, feedback: "FAUX ! La loi franÃ§aise s'applique si victime OU auteur est en France. Snapchat coopÃ¨re avec les autoritÃ©s sur demande judiciaire." },
                            { txt: "L'auto-destruction complique la preuve mais ne l'empÃªche pas", correct: true, feedback: "EXACT ! Snapchat conserve des logs. Les screenshots restent possibles. Et les tÃ©moins peuvent tÃ©moigner. L'Ã©phÃ©mÃ¨re n'est pas l'impunitÃ©." },
                            { txt: "C'est lÃ©gal car les messages disparaissent", correct: false, feedback: "ABSURDE ! Le caractÃ¨re Ã©phÃ©mÃ¨re ne change RIEN Ã  l'infraction. Le harcÃ¨lement est constituÃ© au moment de l'envoi, pas de la conservation." }
                        ]
                    },
                    {
                        texte: "Plusieurs Ã©lÃ¨ves ont chacun postÃ© UN SEUL commentaire nÃ©gatif sous la photo d'un camarade. Individuellement, rien de grave. Mais il y en a 47.",
                        question: "Comment qualifier juridiquement cette situation ?",
                        choix: [
                            { txt: "Pas de harcÃ¨lement car chacun n'a agi qu'une fois", correct: false, feedback: "FAUX ! C'est l'EFFET DE MEUTE (Loi 2022). La victime subit 47 attaques = rÃ©pÃ©tition. Tous les auteurs sont co-responsables de harcÃ¨lement." },
                            { txt: "HarcÃ¨lement par effet de meute - tous co-responsables", correct: true, feedback: "CORRECT ! Depuis 2022, la rÃ©pÃ©tition peut venir de la multiplicitÃ© des auteurs. 47 personnes Ã— 1 acte = harcÃ¨lement collectif. ResponsabilitÃ© partagÃ©e." },
                            { txt: "Seul l'initiateur (le premier commentaire) est responsable", correct: false, feedback: "NON ! Chaque participant a CHOISI de commenter. Pas d'excuse du type \"j'ai suivi\". La loi ne distingue pas premier et dernier." }
                        ]
                    },
                    {
                        texte: "Un Ã©lÃ¨ve dÃ©couvre qu'un compte TikTok parodique existe Ã  son nom avec des vidÃ©os humiliantes. Le compte a 3 abonnÃ©s et n'a rien postÃ© de \"grave\".",
                        question: "Y a-t-il infraction ?",
                        choix: [
                            { txt: "Non, c'est juste une parodie avec peu d'audience", correct: false, feedback: "ERREUR ! L'USURPATION D'IDENTITÃ‰ est constituÃ©e dÃ¨s la crÃ©ation du compte. Peu importe l'audience ou la \"gravitÃ©\" du contenu. C'est 1 an + 15 000â‚¬." },
                            { txt: "Oui, usurpation d'identitÃ© numÃ©rique immÃ©diate", correct: true, feedback: "EXACT ! Article 226-4-1 : utiliser l'identitÃ© d'autrui pour troubler sa tranquillitÃ© est un DÃ‰LIT. Pas besoin d'attendre du contenu grave. Le compte lui-mÃªme est l'infraction." },
                            { txt: "Il faut attendre qu'il y ait du contenu vraiment blessant", correct: false, feedback: "DANGEREUX ! Attendre = laisser l'infraction s'aggraver. L'usurpation est dÃ©jÃ  constituÃ©e. Agir MAINTENANT permet de stopper avant l'escalade." }
                        ]
                    }
                ]
            },
            
            niveau3: {
                titre: "Cyber-OpÃ©rations",
                type: "dojo",
                xp_reward: 200,
                scenarios: [
                    {
                        contexte: "Un Ã©lÃ¨ve de 4Ã¨me te confie qu'il reÃ§oit des photos intimes d'une camarade, envoyÃ©es par un tiers sans le consentement de la fille. Il ne les a pas demandÃ©es mais les a reÃ§ues.",
                        question: "Quelle est sa situation juridique ET que doit-il faire ?",
                        choix: [
                            { txt: "Il n'est pas responsable puisqu'il n'a rien demandÃ©", impact: 20, level: "partial", feedback: "ATTENTION ! S'il conserve ou transfÃ¨re ces images, il devient CO-AUTEUR de la diffusion. Sa responsabilitÃ© dÃ©pend de ce qu'il fait MAINTENANT." },
                            { txt: "Il doit supprimer immÃ©diatement et signaler Ã  un adulte", impact: 100, level: "optimal", feedback: "PARFAIT ! Ne pas conserver (Ã©vite la complicitÃ©), signaler (protÃ¨ge la victime), ne pas transfÃ©rer (stoppe la diffusion). C'est la seule rÃ©ponse Ã©thique ET lÃ©gale." },
                            { txt: "Il doit les montrer Ã  la victime pour qu'elle sache", impact: -30, level: "error", feedback: "CATASTROPHIQUE ! Montrer Ã  la victime = nouvelle diffusion = infraction. Il doit prÃ©venir un adulte qui gÃ©rera avec tact." }
                        ]
                    },
                    {
                        contexte: "Une story Instagram montre une bagarre dans la cour avec commentaire moqueur sur la victime. La story a dÃ©jÃ  200 vues et va expirer dans 2 heures. Tu la vois par hasard.",
                        question: "Priorisation : que fais-tu EN PREMIER ?",
                        choix: [
                            { txt: "Je signale Ã  Instagram pour qu'ils suppriment", impact: 30, level: "partial", feedback: "Utile mais PAS prioritaire. Instagram mettra des heures/jours Ã  traiter. Pendant ce temps, la story continue de circuler ET la preuve risque de disparaÃ®tre." },
                            { txt: "Je screenshot d'abord, puis je signale Ã  un adulte rÃ©fÃ©rent", impact: 100, level: "optimal", feedback: "OPTIMAL ! 1) Capturer la preuve AVANT expiration 2) Signaler Ã  l'adulte qui actionnera les leviers institutionnels. Tu sÃ©curises ET tu agis." },
                            { txt: "J'attends qu'elle expire, Ã§a Ã©vitera de faire des vagues", impact: -40, level: "error", feedback: "COMPLICITÃ‰ PASSIVE ! Ne rien faire = permettre la diffusion. De plus, la preuve disparaÃ®t et l'impunitÃ© encourage la rÃ©cidive." }
                        ]
                    },
                    {
                        contexte: "Tu dÃ©couvres un serveur Discord \"privÃ©\" oÃ¹ des Ã©lÃ¨ves de ton collÃ¨ge classent leurs camarades par \"beautÃ©\" avec des photos volÃ©es. Tu n'en fais pas partie mais un ami t'en a parlÃ©.",
                        question: "Quelle chaÃ®ne d'action recommandes-tu ?",
                        choix: [
                            { txt: "Demander Ã  mon ami de screenshot puis confronter directement les crÃ©ateurs", impact: 10, level: "partial", feedback: "RISQUÃ‰ ! Confronter directement peut : 1) Les alerter (suppression des preuves) 2) Te cibler comme \"balance\". Passe par les adultes." },
                            { txt: "Signaler au CPE avec le maximum d'infos (nom du serveur, participants connus)", impact: 100, level: "optimal", feedback: "EXCELLENT ! Tu donnes les Ã©lÃ©ments pour une enquÃªte interne. Le CPE peut saisir les autoritÃ©s si nÃ©cessaire. Tu ne t'exposes pas et tu agis efficacement." },
                            { txt: "Ne rien faire car je n'en fais pas partie", impact: -50, level: "error", feedback: "NON-ASSISTANCE ! Tu as connaissance d'infractions multiples (droit Ã  l'image, potentiel harcÃ¨lement). Le silence = complicitÃ© morale. Agir protÃ¨ge les victimes." }
                        ]
                    }
                ]
            }
        };

        const generateSaveCode = (progress) => {
            const payload = { v: 1, d: new Date().toISOString(), m: MODULE_DATA.id, mv: MODULE_DATA.version, n: progress.nom || "Anonyme", c: progress.classe || "", l: progress.currentLevel, s: progress.score, x: progress.xp, q: progress.quizScore, dj: progress.dojoScore, f: progress.finished };
            return btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
        };

        const decodeSaveCode = (code) => {
            try { return { valid: true, data: JSON.parse(decodeURIComponent(escape(atob(code.trim())))) }; }
            catch (e) { return { valid: false, error: "Code invalide." }; }
        };

        const verifyPrerequisite = (code) => {
            const result = decodeSaveCode(code);
            if (!result.valid) return { valid: false, error: "Code invalide." };
            if (result.data.m !== MODULE_DATA.prerequis) return { valid: false, error: `Ce code provient du module ${result.data.m}, pas du module ${MODULE_DATA.prerequis}.` };
            if (!result.data.f) return { valid: false, error: "Ce module n'a pas Ã©tÃ© terminÃ©." };
            return { valid: true, data: result.data };
        };

        const e = React.createElement;
        const { useState } = React;

        function Header({ showProgress, xp }) {
            return e('div', { className: 'header' },
                e('div', { className: 'level-badge' }, `NIVEAU ${MODULE_DATA.niveau_difficulte}`),
                e('h1', null, MODULE_DATA.titre),
                e('div', { className: 'subtitle' }, MODULE_DATA.sous_titre),
                showProgress && e('div', { style: { marginTop: '10px' } }, e('span', { className: 'xp-badge' }, `âš¡ ${xp} XP`))
            );
        }

        function ProgressBar({ currentLevel, xp }) {
            const percent = Math.min(100, (currentLevel / 3) * 100);
            return e('div', { className: 'progress-container' },
                e('div', { className: 'progress-stats' }, e('span', null, `Niveau ${currentLevel}/3`), e('span', { className: 'xp-badge' }, `${xp} XP`)),
                e('div', { className: 'progress-bar-outer' }, e('div', { className: 'progress-bar-inner', style: { width: `${percent}%` } }))
            );
        }

        function LevelIndicator({ current }) {
            const levels = ['ðŸ“¡', 'ðŸ”', 'ðŸŽ¯'];
            return e('div', { className: 'level-indicator' }, levels.map((emoji, i) => e('div', { key: i, className: `level-dot ${i + 1 === current ? 'active' : ''} ${i + 1 < current ? 'completed' : ''}` }, i + 1 < current ? 'âœ“' : emoji)));
        }

        function Flashcard({ card, onNext, isLast, onComplete }) {
            const [flipped, setFlipped] = useState(false);
            return e('div', { className: 'flashcard-container' },
                e('div', { className: `flashcard ${flipped ? 'flipped' : ''}`, onClick: () => setFlipped(!flipped) },
                    e('div', { className: 'front' }, e('div', { className: 'question', style: { whiteSpace: 'pre-line' } }, card.recto), e('div', { className: 'tap-hint' }, 'ðŸ‘† Clique pour retourner')),
                    e('div', { className: 'back' }, e('div', { className: 'answer-label' }, 'âœ“ RÃ©ponse'), e('div', { className: 'answer', style: { whiteSpace: 'pre-line' } }, card.verso), e('div', { className: 'source' }, `ðŸ“– ${card.source}`))
                ),
                e('div', { className: 'text-center', style: { marginTop: '20px' } },
                    flipped && (isLast ? e('button', { className: 'btn btn-success', onClick: onComplete }, 'âœ“ VALIDER') : e('button', { className: 'btn', onClick: () => { onNext(); setFlipped(false); } }, 'SUIVANT â†’'))
                )
            );
        }

        function QuizQuestion({ question, onAnswer }) {
            const [answered, setAnswered] = useState(false);
            const [selectedIdx, setSelectedIdx] = useState(null);
            const [feedback, setFeedback] = useState(null);
            const handleChoice = (choice, idx) => { if (answered) return; setAnswered(true); setSelectedIdx(idx); setFeedback({ correct: choice.correct, text: choice.feedback }); };
            return e('div', null,
                e('div', { className: 'quiz-question' }, e('div', { className: 'label' }, 'ðŸ’» SITUATION'), e('p', { style: { marginBottom: '15px', lineHeight: '1.6' } }, question.texte), question.question && e('p', { style: { fontWeight: 'bold', color: '#ff006e' } }, `â“ ${question.question}`)),
                e('div', { className: 'quiz-choices' }, question.choix.map((choice, idx) => e('button', { key: idx, className: `quiz-choice ${answered ? (idx === selectedIdx ? (choice.correct ? 'correct' : 'incorrect') : 'disabled') : ''}`, onClick: () => handleChoice(choice, idx), disabled: answered }, choice.txt))),
                feedback && e('div', { className: `feedback ${feedback.correct ? 'correct' : 'incorrect'}` }, e('div', { className: 'title' }, feedback.correct ? 'âœ“ CORRECT !' : 'âœ— ERREUR DE PROTOCOLE'), e('p', null, feedback.text), e('button', { className: 'btn', style: { marginTop: '20px' }, onClick: () => onAnswer(feedback.correct) }, 'CONTINUER â†’'))
            );
        }

        function DojoScenario({ scenario, onAnswer }) {
            const [answered, setAnswered] = useState(false);
            const [selectedChoice, setSelectedChoice] = useState(null);
            const handleChoice = (choice) => { if (answered) return; setAnswered(true); setSelectedChoice(choice); };
            const getImpactClass = (impact) => impact >= 80 ? 'impact-positive' : impact > 0 ? 'impact-neutral' : 'impact-negative';
            const getImpactLabel = (impact) => impact >= 0 ? `+${impact}` : `${impact}`;
            return e('div', null,
                e('div', { className: 'dojo-scenario' }, e('div', { className: 'context-label' }, 'ðŸŽ® CYBER-OPÃ‰RATION'), e('p', { className: 'context' }, scenario.contexte), e('div', { className: 'question' }, e('strong', null, 'â“ ', scenario.question))),
                e('div', { className: 'quiz-choices' }, scenario.choix.map((choice, idx) => e('button', { key: idx, className: `quiz-choice ${answered ? (choice === selectedChoice ? (choice.level === 'optimal' ? 'correct' : choice.level === 'error' ? 'incorrect' : '') : 'disabled') : ''}`, onClick: () => handleChoice(choice), disabled: answered }, choice.txt, answered && e('span', { className: `impact-badge ${getImpactClass(choice.impact)}` }, getImpactLabel(choice.impact))))),
                selectedChoice && e('div', { className: `feedback ${selectedChoice.level === 'optimal' ? 'correct' : selectedChoice.level === 'error' ? 'incorrect' : 'correct'}` }, e('div', { className: 'title' }, selectedChoice.level === 'optimal' ? 'ðŸŽ¯ OPÃ‰RATION RÃ‰USSIE !' : selectedChoice.level === 'error' ? 'âš ï¸ FAILLE DE SÃ‰CURITÃ‰' : 'ðŸ‘ ACCEPTABLE'), e('p', null, selectedChoice.feedback), e('button', { className: 'btn', style: { marginTop: '20px' }, onClick: () => onAnswer(selectedChoice.impact) }, 'CONTINUER â†’'))
            );
        }

        function Report({ progress, onRestart, onMenu }) {
            const saveCode = generateSaveCode(progress);
            const [copied, setCopied] = useState(false);
            const copyToClipboard = () => { navigator.clipboard.writeText(saveCode).then(() => { setCopied(true); setTimeout(() => setCopied(false), 2000); }); };
            const getMasteryLevel = () => { const total = progress.quizScore + progress.dojoScore; if (total >= 450) return { label: 'EXPERT', class: 'mastery-expert' }; if (total >= 280) return { label: 'CONFIRMÃ‰', class: 'mastery-confirmed' }; return { label: 'EN FORMATION', class: 'mastery-learning' }; };
            const mastery = getMasteryLevel();
            return e('div', null,
                e('div', { className: 'report' },
                    e('div', { className: 'report-header' }, e('span', { style: { fontSize: '3em', display: 'block', marginBottom: '15px' } }, 'ðŸ“¡'), e('h2', null, 'MODULE 3 COMPLÃ‰TÃ‰'), e('p', null, MODULE_DATA.titre)),
                    e('div', { className: 'report-body' },
                        e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'Agent'), e('span', { className: 'value' }, progress.nom || 'Anonyme')),
                        progress.classe && e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'Classe'), e('span', { className: 'value' }, progress.classe)),
                        e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'XP Total'), e('span', { className: 'value' }, `${progress.xp} XP`)),
                        e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'Score Quiz'), e('span', { className: 'value' }, `${progress.quizScore} pts`)),
                        e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'Score Cyber-Ops'), e('span', { className: 'value' }, `${progress.dojoScore} pts`)),
                        e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'MaÃ®trise'), e('span', { className: `mastery-badge ${mastery.class}` }, mastery.label))
                    )
                ),
                e('div', { className: 'save-code-section' },
                    e('h3', { style: { color: '#00d4ff', marginBottom: '15px' } }, 'ðŸ’¾ CODE DE SAUVEGARDE'),
                    e('p', { style: { opacity: 0.8 } }, 'Ce code dÃ©bloque le MODULE 4 !'),
                    e('div', { className: 'save-code-box' }, saveCode),
                    e('button', { className: `btn ${copied ? 'btn-success' : ''}`, onClick: copyToClipboard }, copied ? 'âœ“ COPIÃ‰ !' : 'ðŸ“‹ COPIER'),
                    e('div', { className: 'save-instructions' }, e('h4', null, 'ðŸ”“ Prochaine Ã©tape'), e('ul', null, e('li', null, 'Ce code dÃ©bloque le Module 4 : "Le Protocole pHARe"'), e('li', null, 'Envoie-le aussi au CPE pour valider ta progression')))
                ),
                e('div', { className: 'btn-group' }, e('button', { className: 'btn btn-secondary', onClick: onMenu }, 'ðŸ  MENU'), e('button', { className: 'btn btn-warning', onClick: onRestart }, 'ðŸ”„ RECOMMENCER'))
            );
        }

        function App() {
            const [mode, setMode] = useState('menu');
            const [unlocked, setUnlocked] = useState(false);
            const [currentLevel, setCurrentLevel] = useState(1);
            const [cardIdx, setCardIdx] = useState(0);
            const [questionIdx, setQuestionIdx] = useState(0);
            const [scenarioIdx, setScenarioIdx] = useState(0);
            const [xp, setXp] = useState(0);
            const [quizScore, setQuizScore] = useState(0);
            const [dojoScore, setDojoScore] = useState(0);
            const [nom, setNom] = useState(getHubPlayer() || 'Agent');
            const [classe, setClasse] = useState('');
            const [unlockCode, setUnlockCode] = useState('');
            const [unlockError, setUnlockError] = useState('');

            const resetProgress = () => { setCurrentLevel(1); setCardIdx(0); setQuestionIdx(0); setScenarioIdx(0); setXp(0); setQuizScore(0); setDojoScore(0); };
            const progress = { nom, classe, currentLevel, xp, quizScore, dojoScore, score: quizScore + dojoScore, finished: mode === 'report' };

            const handleUnlock = () => {
                const result = verifyPrerequisite(unlockCode);
                if (result.valid) { setNom(result.data.n || ''); setClasse(result.data.c || ''); setUnlocked(true); setUnlockError(''); }
                else { setUnlockError(result.error); }
            };

            if (mode === 'menu') {
                return e('div', { className: 'app-container' },
                    e(Header, { showProgress: false }),
                    e('div', { className: 'card' }, e('strong', null, 'ðŸŽ¯ MISSION : '), MODULE_DATA.description),
                    !unlocked ? e('div', { className: 'unlock-section' },
                        e('h3', null, 'ðŸ” MODULE VERROUILLÃ‰'),
                        e('p', null, `PrÃ©requis : ComplÃ©ter "${MODULE_DATA.prerequis}"`),
                        e('input', { type: 'text', placeholder: 'Code du Module 2...', value: unlockCode, onChange: (ev) => { setUnlockCode(ev.target.value); setUnlockError(''); } }),
                        unlockError && e('div', { className: 'error-msg' }, `âš ï¸ ${unlockError}`),
                        e('button', { className: 'btn', onClick: handleUnlock }, 'ðŸ”“ DÃ‰BLOQUER')
                    ) : e('div', { className: 'btn-group' },
                        e('div', { style: { textAlign: 'center', color: '#00ff88', marginBottom: '10px' } }, `âœ“ Bienvenue ${nom} !`),
                        e('button', { className: 'btn btn-block', onClick: () => setMode('game') }, 'â–¶ï¸ COMMENCER')
                    ),
                    e('div', { style: { marginTop: '30px', textAlign: 'center', opacity: 0.5, fontSize: '0.85em' } }, `Module ${MODULE_DATA.id} v${MODULE_DATA.version}`)
                );
            }

            if (mode === 'game') {
                if (currentLevel === 1) {
                    const cards = MODULE_DATA.niveau1.cartes;
                    return e('div', { className: 'app-container' },
                        e(Header, { showProgress: true, xp }),
                        e(ProgressBar, { currentLevel, xp }),
                        e(LevelIndicator, { current: currentLevel }),
                        e('h2', { style: { textAlign: 'center' } }, 'ðŸ“¡ NIVEAU 1 : THÃ‰ORIE'),
                        e('div', { className: 'card-counter' }, `Carte ${cardIdx + 1} / ${cards.length}`),
                        e(Flashcard, { card: cards[cardIdx], isLast: cardIdx === cards.length - 1, onNext: () => setCardIdx(cardIdx + 1), onComplete: () => { setXp(xp + MODULE_DATA.niveau1.xp_reward); setCurrentLevel(2); setCardIdx(0); } })
                    );
                }
                if (currentLevel === 2) {
                    const questions = MODULE_DATA.niveau2.questions;
                    const handleQuizAnswer = (correct) => { if (correct) setQuizScore(quizScore + 35); if (questionIdx < questions.length - 1) setQuestionIdx(questionIdx + 1); else { setXp(xp + MODULE_DATA.niveau2.xp_reward); setCurrentLevel(3); setQuestionIdx(0); } };
                    return e('div', { className: 'app-container' },
                        e(Header, { showProgress: true, xp }),
                        e(ProgressBar, { currentLevel, xp }),
                        e(LevelIndicator, { current: currentLevel }),
                        e('h2', { style: { textAlign: 'center' } }, 'ðŸ” NIVEAU 2 : FORENSIQUE'),
                        e('div', { className: 'card-counter' }, `Question ${questionIdx + 1} / ${questions.length}`),
                        e(QuizQuestion, { key: questionIdx, question: questions[questionIdx], onAnswer: handleQuizAnswer })
                    );
                }
                if (currentLevel === 3) {
                    const scenarios = MODULE_DATA.niveau3.scenarios;
                    const handleDojoAnswer = (impact) => { setDojoScore(dojoScore + Math.max(0, impact)); if (scenarioIdx < scenarios.length - 1) setScenarioIdx(scenarioIdx + 1); else { setXp(xp + MODULE_DATA.niveau3.xp_reward); setMode('report'); } };
                    return e('div', { className: 'app-container' },
                        e(Header, { showProgress: true, xp }),
                        e(ProgressBar, { currentLevel, xp }),
                        e(LevelIndicator, { current: currentLevel }),
                        e('h2', { style: { textAlign: 'center' } }, 'ðŸŽ¯ NIVEAU 3 : CYBER-OPS'),
                        e('div', { className: 'card-counter' }, `Mission ${scenarioIdx + 1} / ${scenarios.length}`),
                        e(DojoScenario, { key: scenarioIdx, scenario: scenarios[scenarioIdx], onAnswer: handleDojoAnswer })
                    );
                }
            }

            if (mode === 'report') {
                return e('div', { className: 'app-container' },
                    e(Report, { progress: { ...progress, xp: xp + (currentLevel > 3 ? 0 : MODULE_DATA.niveau3.xp_reward) }, onRestart: () => { resetProgress(); setMode('game'); }, onMenu: () => { resetProgress(); setUnlocked(false); setUnlockCode(''); setMode('menu'); } })
                );
            }
            return e('div', { className: 'app-container' }, 'Chargement...');
        }

        ReactDOM.createRoot(document.getElementById('root')).render(e(App));
    
        // === SUPERHUB BRIDGE ===
        function getHubPlayer() {
            try {
                var code = localStorage.getItem('pvs_current_player') || '';
                if (code && code !== 'VISITEUR' && code !== 'ADMIN') return code;
            } catch(e) {}
            return null;
        }
        function sendBridgeEvent(moduleId, score, xp) {
            try {
                var ev = {
                    type: 'MODULE_COMPLETE',
                    moduleId: moduleId,
                    score: score,
                    xp: xp,
                    playerCode: getHubPlayer(),
                    ts: Date.now()
                };
                localStorage.setItem('pvs_bridge_event', JSON.stringify(ev));
                window.dispatchEvent(new Event('pvs_bridge'));
                // â”€â”€ Bridge PIXHARe hub (pvs_bridge_events array) â”€â”€
                var _b = JSON.parse(localStorage.getItem('pvs_bridge_events') || '[]');
                _b.push({ id: 'PIXHARE-' + moduleId + '-' + Date.now(),
                           type: 'PIXHARE_PROGRESS', player: getHubPlayer() || '',
                           module: moduleId, score: score, xp: xp,
                           d: new Date().toISOString() });
                localStorage.setItem('pvs_bridge_events', JSON.stringify(_b));
                window.dispatchEvent(new StorageEvent('storage', { key: 'pvs_bridge_events' }));
            } catch(e) {}
        }
        // === FIN SUPERHUB BRIDGE ===
</script>
</body>
</html>
